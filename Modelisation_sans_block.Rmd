---
title: "Modelisation"
author: "HEMA"
date: "23 mai 2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(tidyselect)
#library(SDMSelect)
library(dplyr)
library(sf)
library(raster)
library(rasterVis)
library(RStoolbox)
library(maptools)
library(rgdal)
library(spdep)
library(ggplot2)
library(ggspatial)
library(blockCV)
library(randomForest)
library(rJava)
library(dismo)
library(ggpubr)
library(questionr)
library(CENFA)
library(kernlab)
library(gbm)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
reshapePA<-function(Rasterstack,espece){
  Pred<-list()
  data<-as.data.frame(Rasterstack)
  PA<-reshape(data, direction = "long", varying=1:ncol(data),v.names = c("Pred"),times =1:ncol(data) )
  PA$Species<-rep(espece,each=nrow(data))
  PA<-PA[,c("Pred","Species")]
  BaseStat<-as.data.frame(cprop(table(PA)))
  BaseStat<-BaseStat %>%
    filter(Pred!="Total") %>%
    filter(Species!="Ensemble")
  
  BaseStat$Freq<-round(BaseStat$Freq,2) 
  Pred[["Predict table"]]<-BaseStat
  plot<-ggbarplot(BaseStat,
                  x = "Species", y = "Freq",
                  fill = "Pred",
                  color = "Pred",
                  legend="top",label=TRUE,lab.pos = "in",ggtheme = theme_bw()) 
  
  Pred[["Plot"]]<-plot
  return(Pred)
}
Explorer<-function (blocks, rasterLayer, speciesData, num) {
  # records<-blocks$records
  # records$fold<-1:nrow(records)
  # records <- records[,c(5,1,2,3,4)] %>% 
  #   mutate(calcul= round((test_0 + test_1)*100/(test_0 + test_1+train_1 + train_0),digits = 0))
  # records.p <- ggtexttable(records,rows = NULL, theme = ttheme("mGreen"))
  # 
  polyObj <- blocks$blocks
  folds <- blocks$folds
  kmax <- length(folds)
  species <- blocks$species
  speciesData <- sf::st_as_sf(speciesData)
  samp <- raster::sampleRegular(rasterLayer[[1]], 5e+05, asRaster = TRUE)
  map_df <- raster::as.data.frame(samp, xy = TRUE, centroids = TRUE, 
                                  na.rm = TRUE)
  colnames(map_df) <- c("Easting", "Northing", "MAP")
  mid <- stats::median(map_df$MAP)
  basePlot <- ggplot2::ggplot() + ggplot2::geom_raster(data = map_df, 
                                                       ggplot2::aes_string(y = "Northing", x = "Easting", fill = "MAP")) + 
    ggplot2::scale_fill_gradient2(low = "darkred", mid = "yellow", 
                                  high = "darkgreen", midpoint = mid) + ggplot2::guides(fill = FALSE) + 
    ggplot2::theme_bw() + ggplot2::labs(x = "", y = "")
  trainSet <- unlist(folds[[num]][1])
  testSet <- unlist(folds[[num]][2])
  training <- speciesData[trainSet, ]
  testing <- speciesData[testSet, ]
  plotPoly <- polyObj[polyObj$folds ==num,]               
  plotPoly <- sf::st_as_sf(plotPoly)
  if (is.null(species)) {
    if (class(blocks) == "SpatialBlock") {
      ptr <- basePlot + ggplot2::geom_sf(data = plotPoly, 
                                         color = "red", fill = "orangered4", alpha = 0.04, 
                                         size = 0.2) + ggplot2::geom_sf(data = training, 
                                                                        alpha = 0.7, color = "blue", size = 2) + 
        ggplot2::ggtitle("Training set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
      pts <- basePlot + ggplot2::geom_sf(data = plotPoly, 
                                         color = "red", fill = "orangered4", alpha = 0.04, 
                                         size = 0.2) + ggplot2::geom_sf(data = testing, 
                                                                        alpha = 0.7, color = "blue", size = 2) + 
        ggplot2::ggtitle("Testing set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
    }
    else {
      ptr <- basePlot + ggplot2::geom_sf(data = training, 
                                         alpha = 0.7, color = "blue", size = 2) + 
        ggplot2::ggtitle("Training set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
      pts <- basePlot + ggplot2::geom_sf(data = testing, 
                                         alpha = 0.7, color = "blue", size = 2) + 
        ggplot2::ggtitle("Testing set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
    }
  }
  else {
    if (class(blocks) == "SpatialBlock") {
      ptr <- basePlot + ggplot2::geom_sf(data = plotPoly, 
                                         color = "red", fill = "orangered4", alpha = 0.04, 
                                         size = 0.2) + ggplot2::geom_sf(data = training, 
                                                                        ggplot2::aes(color = get(species)), show.legend = "point", 
                                                                        alpha = 0.7, size = 2) + ggplot2::labs(color = species) + 
        ggplot2::ggtitle("Training set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
      pts <- basePlot + ggplot2::geom_sf(data = plotPoly, 
                                         color = "red", fill = "orangered4", alpha = 0.04, 
                                         size = 0.2) + ggplot2::geom_sf(data = testing, 
                                                                        ggplot2::aes(color = get(species)), show.legend = "point", 
                                                                        alpha = 0.7, size = 2) + ggplot2::labs(color = species) + 
        ggplot2::ggtitle("Testing set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
    }
    else {
      ptr <- basePlot + ggplot2::geom_sf(data = training, 
                                         ggplot2::aes(color = get(species)), show.legend = "point", 
                                         alpha = 0.7, size = 2) + ggplot2::labs(color = species) + 
        ggplot2::ggtitle("Training set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
      pts <- basePlot + ggplot2::geom_sf(data = testing, 
                                         ggplot2::aes(color = get(species)), show.legend = "point", 
                                         alpha = 0.7, size = 2) + ggplot2::labs(color = species) + 
        ggplot2::ggtitle("Testing set") + theme(plot.title = element_text(hjust = 0.5, size = 10))
    }
  }
  #ptr_pts<-ggpubr::ggarrange(ptr, pts,common.legend = TRUE)
  #plot(cowplot::plot_grid(ptr, pts))
  #plot(ggpubr::ggarrange(ptr,records.p, pts))
  plot(ggpubr::ggarrange(ptr, pts,common.legend = TRUE))
}
################end function
summarise_fold<-function(sb){
  records<-sb$records
  records$fold<-1:nrow(records)
  records <- records[,c(5,1,2,3,4)] %>% 
    mutate(Pourcentage= round((test_0 + test_1)*100/(test_0 + test_1+train_1 + train_0),digits = 0))
  plot(ggpubr::ggtexttable(records,rows = NULL, theme = ttheme("mGreen")))
}
##########end function

ggRSensitivity<-function(RasterLayer){
  samp <- raster::sampleRegular(RasterLayer, 5e+05, asRaster = TRUE)
  map_df <- raster::as.data.frame(samp, xy = TRUE, centroids = TRUE, 
                                  na.rm = TRUE)
  colnames(map_df) <- c("Easting", "Northing", "Sensitivity")
  basePlot1 <- ggplot2::ggplot() + ggplot2::geom_raster(data = map_df, 
                                                     ggplot2::aes_string(y = "Northing", x = "Easting", fill = "Sensitivity"))
  basePlot1<-basePlot1 + ggplot2::theme_bw() + ggplot2::labs(x = "Longitude", y = "Latitude") + ggtitle(label = names(RasterLayer)) + theme(plot.title = element_text(hjust = 0.5, size = 10))
  
  return(basePlot1)
  
}

ggR_Predict<-function(RasterLayer){
  ggR(RasterLayer,geom_raster = TRUE,ggLayer = F) +
    scale_fill_gradientn(name = "", colours = rev(terrain.colors(10)))  +
    theme_bw() + xlab("Longitude") + ylab("Latitude") +
    ggtitle(label = names(RasterLayer)) + theme(plot.title = element_text(hjust = 0.5, size = 10))
  
}
ggR_Predict2<-function(RasterLayer1,RasterLayer2){
  g1<-ggR(RasterLayer1,geom_raster = TRUE,ggLayer = F) +
    scale_fill_gradientn(name = "", colours = rev(terrain.colors(10)))  +
    theme_bw() + xlab("Longitude") + ylab("Latitude") +
    ggtitle(label = "(a)") + theme(plot.title = element_text(hjust = 0.5, size = 10))
  g2<-ggR(RasterLayer2,geom_raster = TRUE,ggLayer = F) +
    scale_fill_gradientn(name = "", colours = rev(terrain.colors(10)))  +
    theme_bw() + xlab("Longitude") + ylab("Latitude") +
    ggtitle(label = "(b)") + theme(plot.title = element_text(hjust = 0.5, size = 10))
  ggpubr::ggarrange(g1,g2,common.legend=TRUE)
}
#### presence absence function
PASpecies<-function ( rasterLayer){
  #speciesData <- sf::st_as_sf(speciesData)
  samp <- raster::sampleRegular(rasterLayer, 5e+05, asRaster = TRUE)
  map_df <- raster::as.data.frame(samp, xy = TRUE, centroids = TRUE, 
                                  na.rm = TRUE)
  colnames(map_df) <- c("Easting", "Northing", "MAP")
  basePlot <- ggplot2::ggplot() + ggplot2::geom_raster(data = map_df, 
                                                     ggplot2::aes_string(y = "Northing", x = "Easting", fill = "MAP"))
  # ptr <- basePlot + ggplot2::geom_sf(data = speciesData, 
  #                                    alpha = 0.7, color = "blue", size = 1) +
  #   ggplot2::theme_bw() + ggplot2::labs(x = "", y = "") 
  # # +
  #   ggtitle(label = names(rasterLayer)) + theme(plot.title = element_text(hjust = 0.5, size = 10))
  # plot(cowplot::plot_grid(ptr))
  basePlot<-basePlot + ggplot2::theme_bw() + ggplot2::labs(x = "Longitude", y = "Latitude") + ggtitle(label = names(rasterLayer)) + theme(plot.title = element_text(hjust = 0.5, size = 10))+scale_fill_manual(values=c("white","green"),name="Espece",labels=c("Absence","Presence"))
  return(basePlot)
  
}
####
PASpecies2<-function ( rasterLayer1,rasterLayer2){
  #speciesData <- sf::st_as_sf(speciesData)
  samp <- raster::sampleRegular(rasterLayer1, 5e+05, asRaster = TRUE)
  map_df <- raster::as.data.frame(samp, xy = TRUE, centroids = TRUE, 
                                  na.rm = TRUE)
  colnames(map_df) <- c("Easting", "Northing", "MAP")
  basePlot1 <- ggplot2::ggplot() + ggplot2::geom_raster(data = map_df, 
                                                     ggplot2::aes_string(y = "Northing", x = "Easting", fill = "MAP"))
  basePlot1<-basePlot1 + ggplot2::theme_bw() + ggplot2::labs(x = "Longitude", y = "Latitude") + ggtitle(label = "(a)") + theme(plot.title = element_text(hjust = 0.5, size = 10))+scale_fill_manual(values=c("white","green"),name="Species",labels=c("Absence","Presence"))
  samp <- raster::sampleRegular(rasterLayer2, 5e+05, asRaster = TRUE)
  map_df <- raster::as.data.frame(samp, xy = TRUE, centroids = TRUE, 
                                  na.rm = TRUE)
  colnames(map_df) <- c("Easting", "Northing", "MAP")
  basePlot2 <- ggplot2::ggplot() + ggplot2::geom_raster(data = map_df, 
                                                     ggplot2::aes_string(y = "Northing", x = "Easting", fill = "MAP"))
  basePlot2<-basePlot2 + ggplot2::theme_bw() + ggplot2::labs(x = "Longitude", y = "Latitude") + ggtitle(label = "(b)") + theme(plot.title = element_text(hjust = 0.5, size = 10))+scale_fill_manual(values=c("white","green"),name="EspÃ¨ce",labels=c("Absence","PrÃ©sence"))
  ggpubr::ggarrange(basePlot1,basePlot2,common.legend = TRUE)
  
  
}
Dist<-function ( rasterLayer, speciesData){
  speciesData <- sf::st_as_sf(speciesData)
  samp <- raster::sampleRegular(rasterLayer, 5e+05, asRaster = TRUE)
  map_df <- raster::as.data.frame(samp, xy = TRUE, centroids = TRUE, 
                                  na.rm = TRUE)
  colnames(map_df) <- c("Easting", "Northing", "MAP")
  basePlot <- ggplot2::ggplot() + ggplot2::geom_raster(data = map_df, 
                                                       ggplot2::aes_string(y = "Northing", x = "Easting", fill = "MAP")) + 
    ggplot2::scale_fill_gradientn(name = "", colours = rev(terrain.colors(10)))
  ptr <- basePlot + ggplot2::geom_sf(data = speciesData, 
                                     alpha = 0.7, color = "blue", size = 1) +
    ggplot2::theme_bw() + ggplot2::labs(x = "", y = "") 
  # +
  #   ggtitle(label = names(rasterLayer)) + theme(plot.title = element_text(hjust = 0.5, size = 10))
  # plot(cowplot::plot_grid(ptr))
  return(ptr)
  
}
#######"import species
Recodificateur <- function(data,espece,varying){
  for (lag_size in espece) {
    data <- data %>% 
      dplyr::mutate(!!sym(lag_size) := as.factor(ifelse(varying == lag_size,1,0)))
  }
  return(data)
}
######construire des bases des espÃ¨ces choisies
Base<-function(Species,coord,espece){
  Species<-st_drop_geometry(Species)
  data<-list()
  for (i in 1:length(espece)) {
    data[[espece[i]]]<-Species[,c(coord[1],coord[2],espece[i])] 
    # %>% 
    #   dplyr::select(coord[1],coord[2],espece[i])
    
  }
  return(data)
}

Selectpredictors<-function(RasterStack,predictors){
  if(length(predictors)==1){
    p<- raster::subset(RasterStack,predictors[[1]]) 
    p<-list(p)
    names(p)<-names(predictors)
    return(p)
  }
  else{
    var<-names(predictors)
    s<-list()

    p<- raster::subset(RasterStack,predictors[[1]])
    s[[var[1]]]<-p
    for (i in 2:length(predictors)) {
      p<- raster::subset(RasterStack,predictors[[i]])
      s[[var[i]]]<-p
    }
    
    return (s)
  }
  
  
}
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
filename<-paste0("C:\\Users\\Hp\\OneDrive\\cirad\\Data\\BD_Arbre","\\arbres_diohine_mai2018_par_Zone_OK_BON.shp")
Species<-st_read(filename,quiet = T)

espece=list()
espece = c("Faidherbia albida","Balanites aegyptiaca","Anogeissus leiocarpus",
           "Adansonia digitata","Acacia nilotica")
Species <- Recodificateur(data = Species,espece = espece,varying = Species$Species)

coord<-list()
coord<-c("xcoord","ycoord") #les variables sur la longitude=xcoord et la latitude=ycoord
Base<-Base(Species,coord,espece)

lsoil<-list.files("F:\\Stage_SDM\\SoilGrids_250m\\",patt="\\.tif")
lsoil<-sprintf("F:\\Stage_SDM\\SoilGrids_250m\\%s",lsoil)

e<-extent(-16.542,-16.348,14.45,14.64)

AETI<-raster(lsoil[1])
AETI.crop<-crop(AETI,e)
names(AETI.crop)<-"AETI"
CLYPPT<-raster(lsoil[2])
CLYPPT.crop<-crop(CLYPPT,e)
names(CLYPPT.crop)<-"CLYPPT"
ORCDRC<-raster(lsoil[3])
ORCDRC.crop<-crop(ORCDRC,e)
names(ORCDRC.crop)<-"ORCDRC"
PHIHOX<-raster(lsoil[4])
PHIHOX.crop<-crop(PHIHOX,e)
names(PHIHOX.crop)<-"PHIHOX"
SLTPPT<-raster(lsoil[5])
SLTPPT.crop<-crop(SLTPPT,e)
names(SLTPPT.crop)<-"SLTPPT"
SNDPPT<-raster(lsoil[6])
SNDPPT.crop<-crop(SNDPPT,e)
names(SNDPPT.crop)<-"SNDPPT"
NTO<-raster(lsoil[7])
NTO.crop<-crop(NTO,e)
names(NTO.crop)<-"NTO"
P<-raster(lsoil[8])
P.crop<-crop(P,e)
names(P.crop)<-"P"
NBWP<-raster(lsoil[9])
NBWP.crop<-crop(NBWP,e)
names(NBWP.crop)<-"NBWP"
SINT<-raster(lsoil[10])
SINT.crop<-crop(SINT,e)
names(SINT.crop)<-"SINT"
SOS<-raster(lsoil[11])
SOS.crop<-crop(SOS,e)
names(SOS.crop)<-"SOS"

##################"
AETI<-projectRaster(AETI.crop,P.crop)
CLYPPT<-projectRaster(CLYPPT.crop,P.crop)
#extent(CLYPPT)<-extent(P.crop)
ORCDRC<-projectRaster(ORCDRC.crop,P.crop)
#extent(ORCDRC)<-extent(P.crop)
PHIHOX<-projectRaster(PHIHOX.crop,P.crop)
fun <- function(x) { x / 10 }
PHIHOX<-calc(PHIHOX,fun)
names(PHIHOX)<-"PHIHOX"
SLTPPT<-projectRaster(SLTPPT.crop,P.crop)
NTO<-projectRaster(NTO.crop,P.crop)
SNDPPT<-projectRaster(SNDPPT.crop,P.crop)
NBWP<-projectRaster(NBWP.crop,P.crop)
SINT<-projectRaster(SINT.crop,P.crop)
SOS<-projectRaster(SOS.crop,P.crop)
P<-P.crop

SoilGrid.crop<-stack(AETI,SINT,SOS,NBWP,CLYPPT,ORCDRC,PHIHOX,SLTPPT,NTO,SNDPPT,P)

###########
l1<-list.files("F:\\Stage_SDM\\WorldClim\\wc2.0_30s_bio\\",patt="\\.tif")
l1<-sprintf("F:\\Stage_SDM\\WorldClim\\wc2.0_30s_bio\\%s",l1)
worldclim<-stack(l1)
worldclim.crop <- crop(worldclim,e)
worldclim.crop<-projectRaster(worldclim.crop,P)
worldclim.crop<-stack(worldclim.crop)
topofilename<-paste0("C:\\Users\\Hp\\OneDrive\\Memoire_ITS4\\shpzones\\variables topographiques","\\topo.shp")
topo <- shapefile(topofilename,verbose=TRUE)

Slo1 <- rasterize(topo, P, field="Slo1")
names(Slo1)<-"Slo1"
Len1 <- rasterize(topo, P, field="Len1")
#plot(Len1)
names(Len1)<-"Len1"
#writeRaster(Len1, filename=file.path(tmp, "Len1.tif"), format="GTiff", overwrite=TRUE)
######
Sll <- rasterize(topo, P, field="Sll")
#plot(Sll) # valeur identique
names(Sll)<-"Sll"
#writeRaster(Sll, filename=file.path(tmp, "Sll.tif"), format="GTiff", overwrite=TRUE)
##### 
Csl <- rasterize(topo, P, field="Csl")
#plot(Csl)
names(Csl)<-"Csl"
#writeRaster(Csl, filename=file.path(tmp, "Csl.tif"), format="GTiff", overwrite=TRUE)
####

Wid1 <- rasterize(topo, P, field="Wid1")
#plot(Wid1)
names(Wid1)<-"Wid1"
#writeRaster(Wid1, filename=file.path(tmp, "Wid1.tif"), format="GTiff", overwrite=TRUE)
#############
Dep1 <- rasterize(topo, P, field="Dep1")
#plot(Dep1)
names(Dep1)<-"Dep1"
#writeRaster(Dep1, filename=file.path(tmp, "Dep1.tif"), format="GTiff", overwrite=TRUE)
###########
Elev <- rasterize(topo, P, field="Elev")
#plot(Elev)
names(Elev)<-"Elev"
#writeRaster(Elev, filename=file.path(tmp, "Elev.tif"), format="GTiff", overwrite=TRUE)
###########
Vartopo<-stack(Slo1,Len1,Sll,Csl,Wid1,Dep1,Elev)
Variables<-stack(SoilGrid.crop,worldclim.crop,Vartopo)

#bio14=17,bio19=22,Sll=31
#names(Variables)
ENFA_var <- dropLayer(Variables, c(17, 22, 33))
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia.albida")
FaidherbiaPr<- Base_Faidherbia_Z %>%
  filter(Faidherbia.albida ==1)
#Transform data as SpatialPointDataFrame
sp::coordinates(FaidherbiaPr) <-~lon+lat
sp::proj4string(FaidherbiaPr) <-"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites.aegyptiaca")
BalanitesPr<- Base_Balanites_Z %>%
  filter(Balanites.aegyptiaca ==1)
#Transform data as SpatialPointDataFrame
sp::coordinates(BalanitesPr) <-~lon+lat
sp::proj4string(BalanitesPr) <-"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus.leiocarpus")
AnogeissusPr<- Base_Anogeissus_Z %>%
  filter(Anogeissus.leiocarpus ==1)
#Transform data as SpatialPointDataFrame
sp::coordinates(AnogeissusPr) <-~lon+lat
sp::proj4string(AnogeissusPr) <-"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia.digitata")
AdansoniaPr<- Base_Adansonia_Z %>%
  filter(Adansonia.digitata ==1)
#Transform data as SpatialPointDataFrame
sp::coordinates(AdansoniaPr) <-~lon+lat
sp::proj4string(AdansoniaPr) <-"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia.nilotica")
AcaciaPr<- Base_Acacia_Z %>%
  filter(Acacia.nilotica ==1)
#Transform data as SpatialPointDataFrame
sp::coordinates(AcaciaPr) <-~lon+lat
sp::proj4string(AcaciaPr) <-"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Matrice de correlation des predicteurs"}
glc <- GLcenfa(x = ENFA_var)
# correlation matrix
Z <- CENFA::parScale(ENFA_var)
mat <- CENFA::parCov(Z)
# ggcorrplot::ggcorrplot(mat,ggtheme = ggplot2::theme_gray,
#            hc.order = TRUE,
#            type = "lower",
#            lab = FALSE,
#            colors = c("#6D9EC1", "white", "#E46726")) 
pa_dataF <- st_as_sf(Base_Faidherbia_Z, coords = c("lon","lat"), crs = crs(ENFA_var))
Cor <- raster::extract(ENFA_var, pa_dataF, df = TRUE)
Cor<-Cor[,-1]
# Add correlation significance level
# --------------------------------
# Argument p.mat
# Barring the no significant coefficient

p.mat <- ggcorrplot::cor_pmat(Cor)
ggcorrplot::ggcorrplot(mat,ggtheme = ggplot2::theme_gray,
                 hc.order = TRUE,
                 type = "lower",
                 p.mat = p.mat,
                 colors = c("#6D9EC1", "white", "#E46726"))
```

##ENFA  Faidherbia albida
```{r echo=FALSE, message=FALSE, warning=FALSEfig.cap="Analyse factorielle de la niche ecologique (ENFA) de la distribution de Faidherbia albida"}
var_expli<-list()
var_explibio<-list()
FaidherbiaPr@data$Faidherbia.albida<-as.numeric(FaidherbiaPr@data$Faidherbia.albida)
mod.enfa <- CENFA::enfa(x = ENFA_var, s.dat = FaidherbiaPr, field = "Faidherbia.albida")
var_expli[[espece[1]]]<-dropLayer(ENFA_var,c("bio2","bio3","bio6"))
var_explibio[[espece[1]]]<-subset(ENFA_var,str_subset(names(var_expli[[1]]),"bio"))
CENFA::scatter(x = mod.enfa, y = glc,n=34,p=1)
#names(var_explibio[[1]])
mod.cnfa <- CENFA::cnfa(x = var_expli$`Faidherbia albida`, s.dat = FaidherbiaPr, field = "Faidherbia.albida")
#mod.cnfa
s.map <- CENFA::sensitivity_map(mod.cnfa)
plot(s.map)
ggR_Predict(s.map)
```

##ENFA  Balanites
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Analyse factorielle de la niche ecologique (ENFA) de la distribution de Balanites aegyptiaca"}
BalanitesPr@data$Balanites.aegyptiaca<-as.numeric(BalanitesPr@data$Balanites.aegyptiaca)
mod.enfaB <- CENFA::enfa(x = ENFA_var, s.dat = BalanitesPr, field = "Balanites.aegyptiaca")
var_expli[[espece[2]]]<-dropLayer(ENFA_var,c("bio2","bio3","bio5","bio6","bio7","bio12","bio16"))
var_explibio[[espece[2]]]<-subset(ENFA_var,str_subset(names(var_expli[[2]]),"bio"))
CENFA::scatter(x = mod.enfaB, y = glc,n=34,p=1)
mod.cnfaB <- cnfa(x = var_expli$`Balanites aegyptiaca`, s.dat = BalanitesPr, field = "Balanites.aegyptiaca")
#mod.cnfaB

s.mapB <- sensitivity_map(mod.cnfaB)
plot(s.mapB)
ggR_Predict(s.mapB)
```

##ENFA Anogeissus
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Analyse factorielle de la niche ecologique (ENFA) de la distribution de Anogeissus leiocarpus"}
AnogeissusPr@data$Anogeissus.leiocarpus<-as.numeric(AnogeissusPr@data$Anogeissus.leiocarpus)
mod.enfaAno <- CENFA::enfa(x = ENFA_var, s.dat = AnogeissusPr, field = "Anogeissus.leiocarpus")
var_expli[[espece[3]]]<-dropLayer(ENFA_var,c("bio2","bio3","bio5","bio6","bio7","bio12","bio16"))
var_explibio[[espece[3]]]<-subset(ENFA_var,str_subset(names(var_expli[[3]]),"bio"))
CENFA::scatter(x = mod.enfaAno, y = glc,n=34,p=1)
mod.cnfaAno <- cnfa(x = var_expli$`Anogeissus leiocarpus`, s.dat = AnogeissusPr, field = "Anogeissus.leiocarpus")
#mod.cnfaAno
s.mapAno <- sensitivity_map(mod.cnfaAno)
#plot(s.mapAno)
ggR_Predict(s.mapAno)
```

##ENFA Adansonia
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Analyse factorielle de la niche ecologique (ENFA) de la distribution de Adansonia digitata"}
AdansoniaPr@data$Adansonia.digitata<-as.numeric(AdansoniaPr@data$Adansonia.digitata)
mod.enfaAdan <- CENFA::enfa(x = ENFA_var, s.dat = AdansoniaPr, field = "Adansonia.digitata")
var_expli[[espece[4]]]<-dropLayer(ENFA_var,c("bio1","bio2","bio3","bio5","bio6","bio7","bio9",
                                         "bio11","bio10","bio12","bio13","bio16","Csl","PHIHOX","SOS","SNPPT"))
var_explibio[[espece[4]]]<-subset(ENFA_var,str_subset(names(var_expli[[4]]),"bio"))
CENFA::scatter(x = mod.enfaAdan, y = glc,n=34,p=1)
mod.cnfaAdan <- cnfa(x = var_expli$`Adansonia digitata`, s.dat = AdansoniaPr, field = "Adansonia.digitata")
#mod.cnfaAdan
s.mapAdan <- sensitivity_map(mod.cnfaAdan)
plot(s.mapAdan)
ggR_Predict(s.mapAdan)
```

##ENFA Acacia
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Analyse factorielle de la niche ecologique (ENFA) de la distribution de Acacia nilotica"}
AcaciaPr@data$Acacia.nilotica<-as.numeric(AcaciaPr@data$Acacia.nilotica)
mod.enfaAca <- CENFA::enfa(x = ENFA_var, s.dat = AcaciaPr, field = "Acacia.nilotica")
var_expli[[espece[5]]]<-dropLayer(ENFA_var,c("bio2","bio3","bio5","bio7","bio10","bio12","bio13","bio15","bio16"))
var_explibio[[espece[5]]]<-subset(ENFA_var,str_subset(names(var_expli[[5]]),"bio"))
CENFA::scatter(x = mod.enfaAca, y = glc,n=34,p=1)
mod.cnfaAca <- cnfa(x = var_expli$`Acacia nilotica`, s.dat = AcaciaPr, field = "Acacia.nilotica")
#mod.cnfaAca
s.mapAca <- sensitivity_map(mod.cnfaAca)
#plot(s.mapAca)
ggR_Predict(s.mapAca)
```

```{r}
#### CENFA Sensitivity
names(s.map)<-"Faidherbia albida"
names(s.mapB)<-"Balanites aegyptiaca"
names(s.mapAno)<-"Anogeissus leiocarpus"
names(s.mapAdan)<-"Adansonia digitata"
names(s.mapAca)<-"Acacia nilotica"
ggarrange(ggRSensitivity(s.map),ggRSensitivity(s.mapB),
          ggRSensitivity(s.mapAno),ggRSensitivity(s.mapAdan),
          ggRSensitivity(s.mapAca),common.legend = TRUE)
```


# Constitution des blocks spatiaux

```{r echo=FALSE, message=FALSE, warning=FALSE}
sac<-spatialAutoRange(rasterLayer = ENFA_var, # raster file
                       doParallel = T, 
                       
                       showPlots = FALSE)


# tableRange<-sac$rangeTable
# summary(tableRange$range)
```

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Autouccoreleation des predicteurs"}
sac$plots$barchart
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
sac$plots$mapplot
```

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Le choix de la taille des blocs"}

# make a SpatialPointsDataFrame object from data.frame
pa_data<-list()
spatialBlock<-list()
set.seed(1994)
for(k in 1:length(espece)){
  pa_data[[espece[k]]]<-st_as_sf(Base[[k]], coords = coord, crs = crs(ENFA_var))
  
  spatialBlock[[espece[k]]]<-spatialBlock(speciesData = pa_data[[espece[k]]],
                   species = espece[k],
                   rasterLayer = ENFA_var,
                   theRange = 8393, # size of the blocks
                   k = 5,
                   showBlocks = TRUE,
                   selection = "random",
                   iteration = 100, # find evenly dispersed folds
                   biomod2Format = FALSE,
                   rows = 6,
                   cols = 6,
                   xOffset = 0, # shift the blocks horizontally
                   yOffset = 0)
}


```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summarise_fold(spatialBlock[[1]])

```

# Modelisation de la distribution des Especes 
### Maxent
#### Faidherbia albida

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Faidherbia albida blocs"}
spatialBlock[[1]]$plots
```

```{r}
Explorer(spatialBlock[[1]], ENFA_var, pa_data$`Faidherbia albida`,1)
```


```{r echo=FALSE, message=FALSE, warning=FALSE,fig.cap="Donnees de test et entrainement"}
summarise_fold(spatialBlock[[1]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")
folds <- spatialBlock[[1]]$folds
for (i in 1:5) {trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Faidherbia_Z[trainSet, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  me_bio[[i]] <- dismo::maxent(var_explibio$`Faidherbia albida`, p, a) #, factors='Sol'
  me_Var[[i]] <- dismo::maxent(var_expli$`Faidherbia albida`, p, a) #, factors='Sol'
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
}
tmpdir<-"C:\\Users\\Hp\\OneDrive\\cirad\\ParcFaidherbia\\Data\\Sorties\\MaxEnt\\"
MaxentpredFaidherbiabio<-list()
MaxentpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
MaxentpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
writeRaster(MaxentpredFaidherbiabio[[espece[1]]], filename=file.path(tmpdir, "Faidherbiabio.tif"), format="GTiff", overwrite=TRUE)
MaxentpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
MaxentpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
#0.6273838
MaxentpredFaidherbiabio[["PresenceAbsence"]]<-MaxentpredFaidherbiabio[[espece[1]]]>MaxentpredFaidherbiabio[["threshold"]]
writeRaster(MaxentpredFaidherbiabio[["PresenceAbsence"]], filename=file.path(tmpdir, "FaidherbiabioPA.tif"), format="GTiff", overwrite=TRUE)
auc <- sapply(eF_Var, function(x){x@auc})
MaxentpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
writeRaster(MaxentpredFaidherbiavar[[espece[1]]], filename=file.path(tmpdir, "Faidherbiavar.tif"), format="GTiff", overwrite=TRUE)
MaxentpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
MaxentpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
#0.5965889
MaxentpredFaidherbiavar[["PresenceAbsence"]]<-MaxentpredFaidherbiavar[[espece[1]]]>MaxentpredFaidherbiavar[["threshold"]]
writeRaster(MaxentpredFaidherbiavar[["PresenceAbsence"]], filename=file.path(tmpdir, "FaidherbiavarPA.tif"), format="GTiff", overwrite=TRUE)
#plot(MaxentpredFaidherbiavar[[espece[1]]]>MaxentpredFaidherbiavar[["threshold"]])
 ggR_Predict2(MaxentpredFaidherbiabio[[espece[1]]],MaxentpredFaidherbiavar[[espece[1]]])
```


```{r}
plot(me_Var[[which.max(auc)]], main=espece[1],xlab="Pourcentage(%)")
```

```{r}
response(me_Var[[which.max(auc)]],var=c("bio5","CLYPPT","bio18"),main=espece[1])
```

```{r}
boxplot(eF_Var[[which.max(auc)]], col=c('red', 'green'),xlab=espece[1])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredFaidherbiabio[["PresenceAbsence"]],MaxentpredFaidherbiavar[["PresenceAbsence"]])
```

#### Balanites aegyptiaca

```{r echo=FALSE, message=FALSE, warning=FALSE}
spatialBlock[[2]]$plots
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summarise_fold(spatialBlock[[2]])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")
folds<-spatialBlock[[2]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Balanites_Z[trainSet, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[testSet, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- maxent(var_explibio$`Balanites aegyptiaca`, p, a) #, factors='Sol'
  meB_Var[[i]] <- maxent(var_expli$`Balanites aegyptiaca`, p, a) #, factors='Sol'
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
MaxentpredBalanitesbio<-list()
MaxentpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
MaxentpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
MaxentpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
MaxentpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
#0.606967
MaxentpredBalanitesbio[["PresenceAbsence"]]<-MaxentpredBalanitesbio[[espece[2]]]>MaxentpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
MaxentpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
MaxentpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
MaxentpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
#0.5391948
MaxentpredBalanitesvar[["PresenceAbsence"]]<-MaxentpredBalanitesvar[[espece[2]]]>MaxentpredBalanitesvar[["threshold"]]

writeRaster(MaxentpredBalanitesbio[[espece[2]]], filename=file.path(tmpdir, "Balanitesbio.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredBalanitesbio[["PresenceAbsence"]], filename=file.path(tmpdir, "BalanitesbioPA.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredBalanitesvar[[espece[2]]], filename=file.path(tmpdir, "Balanitesvar.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredBalanitesvar[["PresenceAbsence"]], filename=file.path(tmpdir, "BalanitesvarPA.tif"), format="GTiff", overwrite=TRUE)
#plot(MaxentpredFaidherbiavar[[espece[1]]])
 ggR_Predict2(MaxentpredBalanitesbio[[espece[2]]],MaxentpredBalanitesvar[[espece[2]]])
```



```{r}
plot(meB_Var[[which.max(auc)]], main=espece[2],xlab="Pourcentage(%)")
```

```{r}
response(meB_Var[[which.max(auc)]],var=c("bio18","bio15","AETI"),main=espece[2])
```

```{r}
boxplot(eB_Var[[which.max(auc)]], col=c('red', 'green'),xlab=espece[2])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredBalanitesbio[["PresenceAbsence"]],MaxentpredBalanitesvar[["PresenceAbsence"]])
```


#### Anogeissus

```{r echo=FALSE, message=FALSE, warning=FALSE}
spatialBlock[[3]]$plots
```


```{r}
summarise_fold(spatialBlock[[3]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")
folds<-spatialBlock[[3]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Anogeissus_Z[trainSet, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[testSet, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- maxent(var_explibio$`Anogeissus leiocarpus`, p, a) #, factors='Sol'
  meAno_Var[[i]] <- maxent(var_expli$`Anogeissus leiocarpus`, p, a) #, factors='Sol'
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
MaxentpredAnogeissusbio<-list()
MaxentpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
MaxentpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
MaxentpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
MaxentpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
#0.9103008
MaxentpredAnogeissusbio[["PresenceAbsence"]]<-MaxentpredAnogeissusbio[[espece[3]]]>MaxentpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
MaxentpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
MaxentpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
MaxentpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
#0.4864574
MaxentpredAnogeissusvar[["PresenceAbsence"]]<-MaxentpredAnogeissusvar[[espece[3]]]>MaxentpredAnogeissusvar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]])
writeRaster(MaxentpredAnogeissusbio[[espece[3]]], filename=file.path(tmpdir, "Anogeissusbio.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAnogeissusbio[["PresenceAbsence"]], filename=file.path(tmpdir, "AnogeissusbioPA.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAnogeissusvar[[espece[3]]], filename=file.path(tmpdir, "Anogeissusvar.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAnogeissusvar[["PresenceAbsence"]], filename=file.path(tmpdir, "AnogeissusvarPA.tif"), format="GTiff", overwrite=TRUE)
ggR_Predict2(MaxentpredAnogeissusbio[[espece[3]]],MaxentpredAnogeissusvar[[espece[3]]])
```


```{r}
plot(meAno_Var[[which.max(auc)]], main=espece[3],xlab="Pourcentage(%)")
```

```{r}
response(meAno_Var[[which.max(auc)]],var=c("bio13","SNDPPT","Dep1"),main=espece[3])
```

```{r}
boxplot(eAno_Var[[which.max(auc)]], col=c('red', 'green'),xlab=espece[3])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredAnogeissusbio[["PresenceAbsence"]],MaxentpredAnogeissusvar[["PresenceAbsence"]])
```

#### Adansonia

```{r echo=FALSE, message=FALSE, warning=FALSE}
spatialBlock[[4]]$plots
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summarise_fold(spatialBlock[[4]])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")
folds<-spatialBlock[[4]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Adansonia_Z[trainSet, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- maxent(var_explibio$`Adansonia digitata`, p, a) #, factors='Sol'
  meAdan_Var[[i]] <- maxent(var_expli$`Adansonia digitata`, p, a) #, factors='Sol'
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
MaxentpredAdansoniabio<-list()
MaxentpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
MaxentpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
MaxentpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
MaxentpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
#0.7525159
MaxentpredAdansoniabio[["PresenceAbsence"]]<-MaxentpredAdansoniabio[[espece[4]]]>MaxentpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
MaxentpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
MaxentpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
MaxentpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
#0.7080605
MaxentpredAdansoniavar[["PresenceAbsence"]]<-MaxentpredAdansoniavar[[espece[4]]]>MaxentpredAdansoniavar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]])
writeRaster(MaxentpredAdansoniabio[[espece[4]]], filename=file.path(tmpdir, "Adansoniabio.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAdansoniabio[["PresenceAbsence"]], filename=file.path(tmpdir, "AdansoniabioPA.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAdansoniavar[[espece[4]]], filename=file.path(tmpdir, "Adansoniavar.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAdansoniavar[["PresenceAbsence"]], filename=file.path(tmpdir, "AdansoniavarPA.tif"), format="GTiff", overwrite=TRUE)
ggR_Predict2(MaxentpredAdansoniabio[[espece[4]]],MaxentpredAdansoniavar[[espece[4]]])
```

```{r}
plot(meAdan_Var[[which.max(auc)]], main=espece[4],xlab="Pourcentage(%)")
```

```{r}
response(meAdan_Var[[which.max(auc)]],var=c("AETI","SINT","NBWP"),main=espece[4])
```

```{r}
boxplot(eAdan_Var[[which.max(auc)]], col=c('red', 'green'),xlab=espece[4])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredAdansoniabio[["PresenceAbsence"]],MaxentpredAdansoniavar[["PresenceAbsence"]])
```

#### Acacia

```{r echo=FALSE, message=FALSE, warning=FALSE}
spatialBlock[[5]]$plots
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summarise_fold(spatialBlock[[5]])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")
folds<-spatialBlock[[5]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Acacia_Z[trainSet, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- maxent(var_explibio$`Acacia nilotica`, p, a) #, factors='Sol'
  meAca_Var[[i]] <- maxent(var_expli$`Acacia nilotica`, p, a) #, factors='Sol'
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
MaxentpredAcaciabio<-list()
MaxentpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
MaxentpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
MaxentpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
MaxentpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
#0.6374359
MaxentpredAcaciabio[["PresenceAbsence"]]<-MaxentpredAcaciabio[[espece[5]]]>MaxentpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
MaxentpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
MaxentpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
MaxentpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
#0.4858213
MaxentpredAcaciavar[["PresenceAbsence"]]<-MaxentpredAcaciavar[[espece[5]]]>MaxentpredAcaciavar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]])
writeRaster(MaxentpredAcaciabio[[espece[5]]], filename=file.path(tmpdir, "Acaciabio.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAcaciabio[["PresenceAbsence"]], filename=file.path(tmpdir, "AcaciabioPA.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAcaciavar[[espece[5]]], filename=file.path(tmpdir, "Acaciavar.tif"), format="GTiff", overwrite=TRUE)
writeRaster(MaxentpredAcaciavar[["PresenceAbsence"]], filename=file.path(tmpdir, "AcaciavarPA.tif"), format="GTiff", overwrite=TRUE)
ggR_Predict2(MaxentpredAcaciabio[[espece[5]]],MaxentpredAcaciavar[[espece[5]]])
```


```{r}
plot(meAca_Var[[which.max(auc)]], main=espece[5],xlab="Pourcentage(%)")
```

```{r}
response(meAca_Var[[which.max(auc)]],var=c("PHIHOX","ORCDRC","bio6"),main=espece[5])
```

```{r}
boxplot(eAca_Var[[which.max(auc)]], col=c('red', 'green'),xlab=espece[5])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredAcaciabio[["PresenceAbsence"]],MaxentpredAcaciavar[["PresenceAbsence"]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))

Evaluation$Type<-"MaxEnt"
Evaluation$Blocs<-"Oui"
Evaluation<-as.data.frame.data.frame(Evaluation)
write.csv2(Evaluation,"EvaluationMaxEnt")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) 
```

###bioclim
####Faidherbia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")
folds<-spatialBlock[[1]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Faidherbia_Z[trainSet, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  
  me_bio[[i]] <- dismo::bioclim(var_explibio$`Faidherbia albida`, p)
  me_Var[[i]] <-dismo::bioclim(var_expli$`Faidherbia albida`, p)
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
  
}
bioclimpredFaidherbiabio<-list()
bioclimpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
bioclimpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
bioclimpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiabio[["PresenceAbsence"]]<-bioclimpredFaidherbiabio[[espece[1]]]>bioclimpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
bioclimpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
bioclimpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiavar[["PresenceAbsence"]]<-bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]])
ggR_Predict2(bioclimpredFaidherbiabio[[espece[1]]],bioclimpredFaidherbiavar[[espece[1]]])

```

#### Balanites
```{r echo=FALSE, message=FALSE, warning=FALSE}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")
folds<-spatialBlock[[2]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Balanites_Z[trainSet, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[testSet, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- dismo::bioclim(var_explibio$`Balanites aegyptiaca`, p)
  meB_Var[[i]] <-dismo::bioclim(var_expli$`Balanites aegyptiaca`, p)
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
bioclimpredBalanitesbio<-list()
bioclimpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
bioclimpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
bioclimpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesbio[["PresenceAbsence"]]<-bioclimpredBalanitesbio[[espece[2]]]>bioclimpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
bioclimpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
bioclimpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesvar[["PresenceAbsence"]]<-bioclimpredBalanitesvar[[espece[2]]]>bioclimpredBalanitesvar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]])
# ggR_Predict2(bioclimpredBalanitesbio[[espece[2]]],bioclimpredBalanitesvar[[espece[2]]])
```

### Anogeissus

```{r echo=FALSE, message=FALSE, warning=FALSE}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")
folds<-spatialBlock[[3]]$folds
for (i in 1:5) {
 trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Anogeissus_Z[trainSet, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[testSet, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- dismo::bioclim(var_explibio$`Anogeissus leiocarpus`, p)
  meAno_Var[[i]] <- dismo::bioclim(var_expli$`Anogeissus leiocarpus`, p)
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
bioclimpredAnogeissusbio<-list()
bioclimpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
bioclimpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
bioclimpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusbio[["PresenceAbsence"]]<-bioclimpredAnogeissusbio[[espece[3]]]>bioclimpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
bioclimpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
bioclimpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusvar[["PresenceAbsence"]]<-bioclimpredAnogeissusvar[[espece[3]]]>bioclimpredAnogeissusvar[["threshold"]]
#plot(bioclimpredAnogeissusvar[[espece[2]]]>bioclimpredAnogeissusvar[["threshold"]])
ggR_Predict2(bioclimpredAnogeissusbio[[espece[3]]],bioclimpredAnogeissusvar[[espece[3]]])
```


#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")
folds<-spatialBlock[[4]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Adansonia_Z[trainSet, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- dismo::bioclim(var_explibio$`Adansonia digitata`, p)
  meAdan_Var[[i]] <- dismo::bioclim(var_expli$`Adansonia digitata`, p)
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
bioclimpredAdansoniabio<-list()
bioclimpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
bioclimpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
bioclimpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniabio[["PresenceAbsence"]]<-bioclimpredAdansoniabio[[espece[4]]]>bioclimpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
bioclimpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
bioclimpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniavar[["PresenceAbsence"]]<-bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]]
#plot(bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]])
ggR_Predict2(bioclimpredAdansoniabio[[espece[4]]],bioclimpredAdansoniavar[[espece[4]]])
```


#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")
folds<-spatialBlock[[5]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Acacia_Z[trainSet, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- dismo::bioclim(var_explibio$`Acacia nilotica`, p)
  meAca_Var[[i]] <- dismo::bioclim(var_expli$`Acacia nilotica`, p)
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
bioclimpredAcaciabio<-list()
bioclimpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
bioclimpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
bioclimpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciabio[["PresenceAbsence"]]<-bioclimpredAcaciabio[[espece[5]]]>bioclimpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
bioclimpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
bioclimpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciavar[["PresenceAbsence"]]<-bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]]
#plot(bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]])
ggR_Predict2(bioclimpredAcaciabio[[espece[5]]],bioclimpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))

Evaluation$Type<-"bioclim"

Evaluation$blocs<-"Oui"
write.csv2(Evaluation,"Evaluationbioclim")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### Modèle domain
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")
folds<-spatialBlock[[1]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Faidherbia_Z[trainSet, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  
  me_bio[[i]] <- dismo::domain(var_explibio$`Faidherbia albida`, p)
  me_Var[[i]] <-dismo::domain(var_expli$`Faidherbia albida`, p)
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
  
}
bioclimpredFaidherbiabio<-list()
bioclimpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
bioclimpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
bioclimpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiabio[["PresenceAbsence"]]<-bioclimpredFaidherbiabio[[espece[1]]]>bioclimpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
bioclimpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
bioclimpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiavar[["PresenceAbsence"]]<-bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]])
#ggR_Predict2(bioclimpredFaidherbiabio[[espece[1]]],bioclimpredFaidherbiavar[[espece[1]]])
```

#### Balanites

```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")
folds<-spatialBlock[[2]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Balanites_Z[trainSet, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[testSet, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- dismo::domain(var_explibio$`Balanites aegyptiaca`, p)
  meB_Var[[i]] <-dismo::domain(var_expli$`Balanites aegyptiaca`, p)
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
bioclimpredBalanitesbio<-list()
bioclimpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
bioclimpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
bioclimpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesbio[["PresenceAbsence"]]<-bioclimpredBalanitesbio[[espece[2]]]>bioclimpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
bioclimpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
bioclimpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesvar[["PresenceAbsence"]]<-bioclimpredBalanitesvar[[espece[2]]]>bioclimpredBalanitesvar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]])
# ggR_Predict2(bioclimpredBalanitesbio[[espece[2]]],bioclimpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")
folds<-spatialBlock[[3]]$folds
for (i in 1:5) {
 trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Anogeissus_Z[trainSet, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[testSet, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- dismo::domain(var_explibio$`Anogeissus leiocarpus`, p)
  meAno_Var[[i]] <- dismo::domain(var_expli$`Anogeissus leiocarpus`, p)
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
bioclimpredAnogeissusbio<-list()
bioclimpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
bioclimpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
bioclimpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusbio[["PresenceAbsence"]]<-bioclimpredAnogeissusbio[[espece[3]]]>bioclimpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
bioclimpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
bioclimpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusvar[["PresenceAbsence"]]<-bioclimpredAnogeissusvar[[espece[3]]]>bioclimpredAnogeissusvar[["threshold"]]
#plot(bioclimpredAnogeissusvar[[espece[2]]]>bioclimpredAnogeissusvar[["threshold"]])
ggR_Predict2(bioclimpredAnogeissusbio[[espece[3]]],bioclimpredAnogeissusvar[[espece[3]]])
```

#### Adansonia

```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")
folds<-spatialBlock[[4]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Adansonia_Z[trainSet, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- dismo::domain(var_explibio$`Adansonia digitata`, p)
  meAdan_Var[[i]] <- dismo::domain(var_expli$`Adansonia digitata`, p)
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
bioclimpredAdansoniabio<-list()
bioclimpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
bioclimpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
bioclimpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniabio[["PresenceAbsence"]]<-bioclimpredAdansoniabio[[espece[4]]]>bioclimpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
bioclimpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
bioclimpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniavar[["PresenceAbsence"]]<-bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]]
#plot(bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]])
ggR_Predict2(bioclimpredAdansoniabio[[espece[4]]],bioclimpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")
folds<-spatialBlock[[5]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Acacia_Z[trainSet, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- dismo::domain(var_explibio$`Acacia nilotica`, p)
  meAca_Var[[i]] <- dismo::domain(var_expli$`Acacia nilotica`, p)
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
bioclimpredAcaciabio<-list()
bioclimpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
bioclimpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
bioclimpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciabio[["PresenceAbsence"]]<-bioclimpredAcaciabio[[espece[5]]]>bioclimpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
bioclimpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
bioclimpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciavar[["PresenceAbsence"]]<-bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]]
#plot(bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]])
ggR_Predict2(bioclimpredAcaciabio[[espece[5]]],bioclimpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))

Evaluation$Type<-"domain"
Evaluation$blocs<-"Oui"
write.csv2(Evaluation,"Evaluationdomain")

p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### Modèle mahal
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")
folds<-spatialBlock[[1]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Faidherbia_Z[trainSet, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  
  me_bio[[i]] <- dismo::mahal(var_explibio$`Faidherbia albida`, p)
  me_Var[[i]] <-dismo::mahal(var_expli$`Faidherbia albida`, p)
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
  
}
bioclimpredFaidherbiabio<-list()
bioclimpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
bioclimpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
bioclimpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiabio[["PresenceAbsence"]]<-bioclimpredFaidherbiabio[[espece[1]]]>bioclimpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
bioclimpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
bioclimpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiavar[["PresenceAbsence"]]<-bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]])
#ggR_Predict2(bioclimpredFaidherbiabio[[espece[1]]],bioclimpredFaidherbiavar[[espece[1]]])
```

#### Balanites

```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")
folds<-spatialBlock[[2]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Balanites_Z[trainSet, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[testSet, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- dismo::mahal(var_explibio$`Balanites aegyptiaca`, p)
  meB_Var[[i]] <-dismo::mahal(var_expli$`Balanites aegyptiaca`, p)
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
bioclimpredBalanitesbio<-list()
bioclimpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
bioclimpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
bioclimpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesbio[["PresenceAbsence"]]<-bioclimpredBalanitesbio[[espece[2]]]>bioclimpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
bioclimpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
bioclimpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesvar[["PresenceAbsence"]]<-bioclimpredBalanitesvar[[espece[2]]]>bioclimpredBalanitesvar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]])
# ggR_Predict2(bioclimpredBalanitesbio[[espece[2]]],bioclimpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")
folds<-spatialBlock[[3]]$folds
for (i in 1:5) {
 trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Anogeissus_Z[trainSet, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[testSet, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- dismo::mahal(var_explibio$`Anogeissus leiocarpus`, p)
  meAno_Var[[i]] <- dismo::mahal(var_expli$`Anogeissus leiocarpus`, p)
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
bioclimpredAnogeissusbio<-list()
bioclimpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
bioclimpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
bioclimpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusbio[["PresenceAbsence"]]<-bioclimpredAnogeissusbio[[espece[3]]]>bioclimpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
bioclimpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
bioclimpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusvar[["PresenceAbsence"]]<-bioclimpredAnogeissusvar[[espece[3]]]>bioclimpredAnogeissusvar[["threshold"]]
#plot(bioclimpredAnogeissusvar[[espece[2]]]>bioclimpredAnogeissusvar[["threshold"]])
ggR_Predict2(bioclimpredAnogeissusbio[[espece[3]]],bioclimpredAnogeissusvar[[espece[3]]])
```

#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")
folds<-spatialBlock[[4]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Adansonia_Z[trainSet, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- dismo::mahal(var_explibio$`Adansonia digitata`, p)
  meAdan_Var[[i]] <- dismo::mahal(var_expli$`Adansonia digitata`, p)
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
bioclimpredAdansoniabio<-list()
bioclimpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
bioclimpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
bioclimpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniabio[["PresenceAbsence"]]<-bioclimpredAdansoniabio[[espece[4]]]>bioclimpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
bioclimpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
bioclimpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniavar[["PresenceAbsence"]]<-bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]]
#plot(bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]])
ggR_Predict2(bioclimpredAdansoniabio[[espece[4]]],bioclimpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")
folds<-spatialBlock[[5]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
  train<-Base_Acacia_Z[trainSet, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[testSet, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- dismo::mahal(var_explibio$`Acacia nilotica`, p)
  meAca_Var[[i]] <- dismo::mahal(var_expli$`Acacia nilotica`, p)
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
bioclimpredAcaciabio<-list()
bioclimpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
bioclimpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
bioclimpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciabio[["PresenceAbsence"]]<-bioclimpredAcaciabio[[espece[5]]]>bioclimpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
bioclimpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
bioclimpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciavar[["PresenceAbsence"]]<-bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]]
#plot(bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]])
ggR_Predict2(bioclimpredAcaciabio[[espece[5]]],bioclimpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))

Evaluation$Type<-"mahal"
Evaluation$blocs<-"Oui"

write.csv2(Evaluation,"Evaluationmahal")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Base_Faidherbia_Z<-Base$`Faidherbia albida`
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
Base_Adansonia_Z<-Base$`Adansonia digitata`
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")
names(Base_Balanites_Z)<-c("lon","lat","Balanites")
names(Base_Acacia_Z)<-c("lon","lat","Acacia")
# make a SpatialPointsDataFrame object from data.frame
########"var_explibio
pa_dataF <- st_as_sf(Base_Faidherbia_Z, coords = c("lon","lat"), crs = crs(var_explibio$`Faidherbia albida`))
pa_dataB <- st_as_sf(Base_Balanites_Z, coords = c("lon","lat"), crs = crs(var_explibio$`Balanites aegyptiaca`))
pa_dataAno <- st_as_sf(Base_Anogeissus_Z, coords = c("lon","lat"), crs = crs(var_explibio$`Anogeissus leiocarpus`))
pa_dataAdan <- st_as_sf(Base_Adansonia_Z, coords = c("lon","lat"), crs = crs(var_explibio$`Adansonia digitata`))
pa_dataAca <- st_as_sf(Base_Acacia_Z, coords = c("lon","lat"), crs = crs(var_explibio$`Acacia nilotica`))
########### ajout des variables paysagÃ¨res
pa_dataFVar <- st_as_sf(Base_Faidherbia_Z, coords = c("lon","lat"), crs = crs(var_expli$`Faidherbia albida`))
pa_dataBVar <- st_as_sf(Base_Balanites_Z, coords = c("lon","lat"), crs = crs(var_expli$`Balanites aegyptiaca`))
pa_dataAnoVar <- st_as_sf(Base_Anogeissus_Z, coords = c("lon","lat"), crs = crs(var_expli$`Anogeissus leiocarpus`))
pa_dataAdanVar <- st_as_sf(Base_Adansonia_Z, coords = c("lon","lat"), crs = crs(var_expli$`Adansonia digitata`))
pa_dataAcaVar <- st_as_sf(Base_Acacia_Z, coords = c("lon","lat"), crs = crs(var_expli$`Acacia nilotica`))

################
# extract the raster values for the species points as a dataframe
mydataF <- raster::extract(var_explibio$`Faidherbia albida`, pa_dataF, df = TRUE)
#df_status(mydataF)
mydataB <- raster::extract(var_explibio$`Balanites aegyptiaca`, pa_dataB, df = TRUE)
mydataAno <- raster::extract(var_explibio$`Anogeissus leiocarpus`, pa_dataAno, df = TRUE)
mydataAdan <- raster::extract(var_explibio$`Adansonia digitata`, pa_dataAdan, df = TRUE)
mydataAca <- raster::extract(var_explibio$`Acacia nilotica`, pa_dataAca, df = TRUE)
# adding species column to the dataframe
mydataF$Faidherbia <- as.factor(pa_dataF$Faidherbia)
#mydataF$Sol<-as.factor(mydataF$Sol)
mydataB$Balanites <- as.factor(pa_dataB$Balanites)
#mydataB$Sol<-as.factor(mydataB$Sol)
mydataAno$Anogeissus <- as.factor(pa_dataAno$Anogeissus)
#mydataAno$Sol<-as.factor(mydataAno$Sol)
mydataAdan$Adansonia<-as.factor(pa_dataAdan$Adansonia)
#mydataAdan$Sol<-as.factor(mydataAdan$Sol)
mydataAca$Acacia<-as.factor(pa_dataAca$Acacia)
#mydataAca$Sol<-as.factor(mydataAca$Sol)
# remove extra column (ID)
mydataF <- mydataF[,-1]
mydataB <- mydataB[,-1]
mydataAno <- mydataAno[,-1]
mydataAdan <- mydataAdan[,-1]
mydataAca <- mydataAca[,-1]
###################
################
# extract the raster values for the species points as a dataframe
mydataFVar <- raster::extract(var_expli$`Faidherbia albida`, pa_dataFVar, df = TRUE)
mydataBVar <- raster::extract(var_expli$`Balanites aegyptiaca`, pa_dataBVar, df = TRUE)
mydataAnoVar <- raster::extract(var_expli$`Anogeissus leiocarpus`, pa_dataAnoVar, df = TRUE)
mydataAdanVar <- raster::extract(var_expli$`Adansonia digitata`, pa_dataAdanVar, df = TRUE)
mydataAcaVar <- raster::extract(var_expli$`Acacia nilotica`, pa_dataAcaVar, df = TRUE)
# adding species column to the dataframe
mydataFVar$Faidherbia <- as.factor(pa_dataFVar$Faidherbia)
#mydataFVar$Sol<-as.factor(mydataFVar$Sol)
mydataBVar$Balanites <- as.factor(pa_dataBVar$Balanites)
#mydataBVar$Sol<-as.factor(mydataBVar$Sol)
mydataAnoVar$Anogeissus <- as.factor(pa_dataAnoVar$Anogeissus)
#mydataAnoVar$Sol<-as.factor(mydataAnoVar$Sol)
mydataAdanVar$Adansonia<-as.factor(pa_dataAdanVar$Adansonia)
#mydataAdanVar$Sol<-as.factor(mydataAdanVar$Sol)
mydataAcaVar$Acacia<-as.factor(pa_dataAcaVar$Acacia)
#mydataAcaVar$Sol<-as.factor(mydataAcaVar$Sol)
# remove extra column (ID)
mydataFVar <- mydataFVar[,-1]
mydataBVar <- mydataBVar[,-1]
mydataAnoVar <- mydataAnoVar[,-1]
mydataAdanVar <- mydataAdanVar[,-1]
mydataAcaVar <- mydataAcaVar[,-1]
###################
```


### RandomForest
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
folds<-spatialBlock[[1]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
testpres <- mydataF[mydataF[testSet,ncol(mydataF)] == 1, 1:(ncol(mydataF)-1)]
testbackg <- mydataF[mydataF[testSet,ncol(mydataF)] == 0, 1:(ncol(mydataF)-1)]
  me_bio[[i]] <- randomForest(as.numeric(Faidherbia)~., mydataF[trainSet, ], na.action=na.omit)
  eF_bio[[i]] <- dismo::evaluate(testpres, testbackg, me_bio[[i]])
  testpres <- mydataFVar[mydataFVar[testSet,ncol(mydataFVar)] == 1, 1:ncol(mydataFVar)-1]
testbackg <- mydataFVar[mydataFVar[testSet,ncol(mydataFVar)] == 0, 1:ncol(mydataFVar)-1]
me_Var[[i]] <- randomForest(as.numeric(Faidherbia)~., mydataFVar[trainSet, ], na.action=na.omit)
   eF_Var[[i]] <- dismo::evaluate(testpres, testbackg, me_Var[[i]])
}
RandomForestpredFaidherbiabio<-list()
RandomForestpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
RandomForestpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
RandomForestpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiabio[["PresenceAbsence"]]<-RandomForestpredFaidherbiabio[[espece[1]]]>RandomForestpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
RandomForestpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
RandomForestpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiavar[["PresenceAbsence"]]<-RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]]
#plot(RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]])
ggR_Predict2(RandomForestpredFaidherbiabio[[espece[1]]],RandomForestpredFaidherbiavar[[espece[1]]])
```


#### Balanites
```{r echo=FALSE, message=FALSE, warning=FALSE}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
folds<-spatialBlock[[2]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataB[mydataB[testSet,ncol(mydataB)] == 1, 1:(ncol(mydataB)-1)]
  testbackg <- mydataB[mydataB[testSet,ncol(mydataB)] == 0, 1:(ncol(mydataB)-1)]
  meB_bio[[i]] <- randomForest(as.numeric(Balanites)~., mydataB[trainSet, ], na.action=na.omit)
  eB_bio[[i]] <- dismo::evaluate(testpres, testbackg, meB_bio[[i]])
  testpres <- mydataBVar[mydataBVar[testSet,ncol(mydataBVar)] == 1, 1:ncol(mydataBVar)-1]
  testbackg <- mydataBVar[mydataBVar[testSet,ncol(mydataBVar)] == 0, 1:ncol(mydataBVar)-1]
  meB_Var[[i]] <- randomForest(as.numeric(Balanites)~., mydataBVar[trainSet, ], na.action=na.omit)
  eB_Var[[i]] <- dismo::evaluate(testpres, testbackg, meB_Var[[i]])
}
RandomForestpredBalanitesbio<-list()
RandomForestpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
RandomForestpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
RandomForestpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesbio[["PresenceAbsence"]]<-RandomForestpredBalanitesbio[[espece[2]]]>RandomForestpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
RandomForestpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
RandomForestpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesvar[["PresenceAbsence"]]<-RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]]
#plot(RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]])
ggR_Predict2(RandomForestpredBalanitesbio[[espece[2]]],RandomForestpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r echo=FALSE, message=FALSE, warning=FALSE}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
folds<-spatialBlock[[3]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAno[mydataAno[testSet,ncol(mydataAno)] == 1, 1:(ncol(mydataAno)-1)]
  testbackg <- mydataAno[mydataAno[testSet,ncol(mydataAno)] == 0, 1:(ncol(mydataAno)-1)]
  meAno_bio[[i]] <- randomForest(as.numeric(Anogeissus)~., mydataAno[trainSet, ], na.action=na.omit)
  eAno_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAno_bio[[i]])
  testpres <- mydataAnoVar[mydataAnoVar[testSet,ncol(mydataAnoVar)] == 1, 1:ncol(mydataAnoVar)-1]
  testbackg <- mydataAnoVar[mydataAnoVar[testSet,ncol(mydataAnoVar)] == 0, 1:ncol(mydataAnoVar)-1]
  meAno_Var[[i]] <- randomForest(as.numeric(Anogeissus)~., mydataAnoVar[trainSet, ], na.action=na.omit)
  eAno_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAno_Var[[i]])
}
RandomForestpredAnogeissusbio<-list()
RandomForestpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
RandomForestpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
RandomForestpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusbio[["PresenceAbsence"]]<-RandomForestpredAnogeissusbio[[espece[3]]]>RandomForestpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
RandomForestpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
RandomForestpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusvar[["PresenceAbsence"]]<-RandomForestpredAnogeissusvar[[espece[3]]]>RandomForestpredAnogeissusvar[["threshold"]]
#plot(RandomForestpredAnogeissusvar[[espece[2]]]>RandomForestpredAnogeissusvar[["threshold"]])
ggR_Predict2(RandomForestpredAnogeissusbio[[espece[3]]],RandomForestpredAnogeissusvar[[espece[3]]])
```

#### Adansonia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
folds<-spatialBlock[[4]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAdan[mydataAdan[testSet,ncol(mydataAdan)] == 1, 1:(ncol(mydataAdan)-1)]
  testbackg <- mydataAdan[mydataAdan[testSet,ncol(mydataAdan)] == 0, 1:(ncol(mydataAdan)-1)]
  meAdan_bio[[i]] <- randomForest(as.numeric(Adansonia)~., mydataAdan[trainSet, ], na.action=na.omit)
  eAdan_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_bio[[i]])
  testpres <- mydataAdanVar[mydataAdanVar[testSet,ncol(mydataAdanVar)] == 1, 1:ncol(mydataAdanVar)-1]
  testbackg <- mydataAdanVar[mydataAdanVar[testSet,ncol(mydataAdanVar)] == 0, 1:ncol(mydataAdanVar)-1]
  meAdan_Var[[i]] <- randomForest(as.numeric(Adansonia)~., mydataAdanVar[trainSet, ], na.action=na.omit)
  eAdan_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_Var[[i]])
}
RandomForestpredAdansoniabio<-list()
RandomForestpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
RandomForestpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
RandomForestpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniabio[["PresenceAbsence"]]<-RandomForestpredAdansoniabio[[espece[4]]]>RandomForestpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
RandomForestpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
RandomForestpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniavar[["PresenceAbsence"]]<-RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]]
#plot(RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]])
ggR_Predict2(RandomForestpredAdansoniabio[[espece[4]]],RandomForestpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
folds<-spatialBlock[[5]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAca[mydataAca[testSet,ncol(mydataAca)] == 1, 1:(ncol(mydataAca)-1)]
  testbackg <- mydataAca[mydataAca[testSet,ncol(mydataAca)] == 0, 1:(ncol(mydataAca)-1)]
  meAca_bio[[i]] <- randomForest(as.numeric(Acacia)~., mydataAca[trainSet, ], na.action=na.omit)
  eAca_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAca_bio[[i]])
  testpres <- mydataAcaVar[mydataAcaVar[testSet,ncol(mydataAcaVar)] == 1, 1:ncol(mydataAcaVar)-1]
  testbackg <- mydataAcaVar[mydataAcaVar[testSet,ncol(mydataAcaVar)] == 0, 1:ncol(mydataAcaVar)-1]
  meAca_Var[[i]] <- randomForest(as.numeric(Acacia)~., mydataAcaVar[trainSet, ], na.action=na.omit)
  eAca_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAca_Var[[i]])
}
RandomForestpredAcaciabio<-list()
RandomForestpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
RandomForestpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
RandomForestpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciabio[["PresenceAbsence"]]<-RandomForestpredAcaciabio[[espece[5]]]>RandomForestpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
RandomForestpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
RandomForestpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciavar[["PresenceAbsence"]]<-RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]]
#plot(RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]])
ggR_Predict2(RandomForestpredAcaciabio[[espece[5]]],RandomForestpredAcaciavar[[espece[5]]])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"RF"
Evaluation$blocs<-"Oui"
write.csv2(Evaluation,"EvaluationRF")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### GLM
#### Faidherbia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
folds<-spatialBlock[[1]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
testpres <- mydataF[mydataF[testSet,ncol(mydataF)] == 1, 1:(ncol(mydataF)-1)]
testbackg <- mydataF[mydataF[testSet,ncol(mydataF)] == 0, 1:(ncol(mydataF)-1)]
  me_bio[[i]] <- glm(Faidherbia~., mydataF[trainSet, ], na.action=na.omit,
            family = binomial(link = "logit"))
  eF_bio[[i]] <- dismo::evaluate(testpres, testbackg, me_bio[[i]])
  testpres <- mydataFVar[mydataFVar[testSet,ncol(mydataFVar)] == 1, 1:ncol(mydataFVar)-1]
testbackg <- mydataFVar[mydataFVar[testSet,ncol(mydataFVar)] == 0, 1:ncol(mydataFVar)-1]
me_Var[[i]] <- glm(Faidherbia~., mydataFVar[trainSet, ],
            family = binomial(link = "logit"), na.action=na.omit)
   eF_Var[[i]] <- dismo::evaluate(testpres, testbackg, me_Var[[i]])
}
RandomForestpredFaidherbiabio<-list()
RandomForestpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
RandomForestpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
RandomForestpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiabio[["PresenceAbsence"]]<-RandomForestpredFaidherbiabio[[espece[1]]]>RandomForestpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
RandomForestpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
RandomForestpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiavar[["PresenceAbsence"]]<-RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]]
#plot(RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]])
ggR_Predict2(RandomForestpredFaidherbiabio[[espece[1]]],RandomForestpredFaidherbiavar[[espece[1]]])
```

#### Balanites
```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
folds<-spatialBlock[[2]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataB[mydataB[testSet,ncol(mydataB)] == 1, 1:(ncol(mydataB)-1)]
  testbackg <- mydataB[mydataB[testSet,ncol(mydataB)] == 0, 1:(ncol(mydataB)-1)]
  meB_bio[[i]] <- glm(Balanites~., mydataB[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eB_bio[[i]] <- dismo::evaluate(testpres, testbackg, meB_bio[[i]])
  testpres <- mydataBVar[mydataBVar[testSet,ncol(mydataBVar)] == 1, 1:ncol(mydataBVar)-1]
  testbackg <- mydataBVar[mydataBVar[testSet,ncol(mydataBVar)] == 0, 1:ncol(mydataBVar)-1]
  meB_Var[[i]] <- glm(Balanites~., mydataBVar[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eB_Var[[i]] <- dismo::evaluate(testpres, testbackg, meB_Var[[i]])
}
RandomForestpredBalanitesbio<-list()
RandomForestpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
RandomForestpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
RandomForestpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesbio[["PresenceAbsence"]]<-RandomForestpredBalanitesbio[[espece[2]]]>RandomForestpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
RandomForestpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
RandomForestpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesvar[["PresenceAbsence"]]<-RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]]
#plot(RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]])
ggR_Predict2(RandomForestpredBalanitesbio[[espece[2]]],RandomForestpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
folds<-spatialBlock[[3]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAno[mydataAno[testSet,ncol(mydataAno)] == 1, 1:(ncol(mydataAno)-1)]
  testbackg <- mydataAno[mydataAno[testSet,ncol(mydataAno)] == 0, 1:(ncol(mydataAno)-1)]
  meAno_bio[[i]] <- glm(Anogeissus~., mydataAno[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eAno_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAno_bio[[i]])
  testpres <- mydataAnoVar[mydataAnoVar[testSet,ncol(mydataAnoVar)] == 1, 1:ncol(mydataAnoVar)-1]
  testbackg <- mydataAnoVar[mydataAnoVar[testSet,ncol(mydataAnoVar)] == 0, 1:ncol(mydataAnoVar)-1]
  meAno_Var[[i]] <- glm(Anogeissus~., mydataAnoVar[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eAno_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAno_Var[[i]])
}
RandomForestpredAnogeissusbio<-list()
RandomForestpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
RandomForestpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
RandomForestpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusbio[["PresenceAbsence"]]<-RandomForestpredAnogeissusbio[[espece[3]]]>RandomForestpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
RandomForestpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
RandomForestpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusvar[["PresenceAbsence"]]<-RandomForestpredAnogeissusvar[[espece[3]]]>RandomForestpredAnogeissusvar[["threshold"]]
#plot(RandomForestpredAnogeissusvar[[espece[2]]]>RandomForestpredAnogeissusvar[["threshold"]])
ggR_Predict2(RandomForestpredAnogeissusbio[[espece[3]]],RandomForestpredAnogeissusvar[[espece[3]]])
```

#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
folds<-spatialBlock[[4]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAdan[mydataAdan[testSet,ncol(mydataAdan)] == 1, 1:(ncol(mydataAdan)-1)]
  testbackg <- mydataAdan[mydataAdan[testSet,ncol(mydataAdan)] == 0, 1:(ncol(mydataAdan)-1)]
  meAdan_bio[[i]] <- glm(Adansonia~., mydataAdan[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eAdan_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_bio[[i]])
  testpres <- mydataAdanVar[mydataAdanVar[testSet,ncol(mydataAdanVar)] == 1, 1:ncol(mydataAdanVar)-1]
  testbackg <- mydataAdanVar[mydataAdanVar[testSet,ncol(mydataAdanVar)] == 0, 1:ncol(mydataAdanVar)-1]
  meAdan_Var[[i]] <- glm(Adansonia~., mydataAdanVar[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eAdan_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_Var[[i]])
}
RandomForestpredAdansoniabio<-list()
RandomForestpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
RandomForestpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
RandomForestpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniabio[["PresenceAbsence"]]<-RandomForestpredAdansoniabio[[espece[4]]]>RandomForestpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
RandomForestpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
RandomForestpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniavar[["PresenceAbsence"]]<-RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]]
#plot(RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]])
ggR_Predict2(RandomForestpredAdansoniabio[[espece[4]]],RandomForestpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
folds<-spatialBlock[[5]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAca[mydataAca[testSet,ncol(mydataAca)] == 1, 1:(ncol(mydataAca)-1)]
  testbackg <- mydataAca[mydataAca[testSet,ncol(mydataAca)] == 0, 1:(ncol(mydataAca)-1)]
  meAca_bio[[i]] <- glm(Acacia~., mydataAca[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eAca_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAca_bio[[i]])
  testpres <- mydataAcaVar[mydataAcaVar[testSet,ncol(mydataAcaVar)] == 1, 1:ncol(mydataAcaVar)-1]
  testbackg <- mydataAcaVar[mydataAcaVar[testSet,ncol(mydataAcaVar)] == 0, 1:ncol(mydataAcaVar)-1]
  meAca_Var[[i]] <- glm(Acacia~., mydataAcaVar[trainSet, ],family = binomial(link = "logit"), na.action=na.omit)
  eAca_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAca_Var[[i]])
}
RandomForestpredAcaciabio<-list()
RandomForestpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
RandomForestpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
RandomForestpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciabio[["PresenceAbsence"]]<-RandomForestpredAcaciabio[[espece[5]]]>RandomForestpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
RandomForestpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
RandomForestpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciavar[["PresenceAbsence"]]<-RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]]
#plot(RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]])
ggR_Predict2(RandomForestpredAcaciabio[[espece[5]]],RandomForestpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"glm"
Evaluation$blocs<-"Oui"
write.csv2(Evaluation,"EvaluationGLM")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### SVM
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
folds<-spatialBlock[[1]]$folds
for (i in 1:5) {
trainSet <- unlist(folds[[i]][1]) # training set indices
testSet <- unlist(folds[[i]][2]) # testing set indices
testpres <- mydataF[mydataF[testSet,ncol(mydataF)] == 1, 1:(ncol(mydataF)-1)]
testbackg <- mydataF[mydataF[testSet,ncol(mydataF)] == 0, 1:(ncol(mydataF)-1)]
  me_bio[[i]] <- ksvm(as.numeric(Faidherbia)~., mydataF[trainSet, ], na.action=na.omit)
  eF_bio[[i]] <- dismo::evaluate(testpres, testbackg, me_bio[[i]])
  testpres <- mydataFVar[mydataFVar[testSet,ncol(mydataFVar)] == 1, 1:ncol(mydataFVar)-1]
testbackg <- mydataFVar[mydataFVar[testSet,ncol(mydataFVar)] == 0, 1:ncol(mydataFVar)-1]
me_Var[[i]] <- ksvm(as.numeric(Faidherbia)~., mydataFVar[trainSet, ], na.action=na.omit)
   eF_Var[[i]] <- dismo::evaluate(testpres, testbackg, me_Var[[i]])
}
RandomForestpredFaidherbiabio<-list()
RandomForestpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
RandomForestpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
RandomForestpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiabio[["PresenceAbsence"]]<-RandomForestpredFaidherbiabio[[espece[1]]]>RandomForestpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
RandomForestpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
RandomForestpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiavar[["PresenceAbsence"]]<-RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]]
#plot(RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]])
ggR_Predict2(RandomForestpredFaidherbiabio[[espece[1]]],RandomForestpredFaidherbiavar[[espece[1]]])
```


#### Balanites

```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
folds<-spatialBlock[[2]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataB[mydataB[testSet,ncol(mydataB)] == 1, 1:(ncol(mydataB)-1)]
  testbackg <- mydataB[mydataB[testSet,ncol(mydataB)] == 0, 1:(ncol(mydataB)-1)]
  meB_bio[[i]] <- ksvm(as.numeric(Balanites)~., mydataB[trainSet, ], na.action=na.omit)
  eB_bio[[i]] <- dismo::evaluate(testpres, testbackg, meB_bio[[i]])
  testpres <- mydataBVar[mydataBVar[testSet,ncol(mydataBVar)] == 1, 1:ncol(mydataBVar)-1]
  testbackg <- mydataBVar[mydataBVar[testSet,ncol(mydataBVar)] == 0, 1:ncol(mydataBVar)-1]
  meB_Var[[i]] <- ksvm(as.numeric(Balanites)~., mydataBVar[trainSet, ], na.action=na.omit)
  eB_Var[[i]] <- dismo::evaluate(testpres, testbackg, meB_Var[[i]])
}
RandomForestpredBalanitesbio<-list()
RandomForestpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
RandomForestpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
RandomForestpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesbio[["PresenceAbsence"]]<-RandomForestpredBalanitesbio[[espece[2]]]>RandomForestpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
RandomForestpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
RandomForestpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesvar[["PresenceAbsence"]]<-RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]]
#plot(RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]])
ggR_Predict2(RandomForestpredBalanitesbio[[espece[2]]],RandomForestpredBalanitesvar[[espece[2]]])
```


#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
folds<-spatialBlock[[3]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAno[mydataAno[testSet,ncol(mydataAno)] == 1, 1:(ncol(mydataAno)-1)]
  testbackg <- mydataAno[mydataAno[testSet,ncol(mydataAno)] == 0, 1:(ncol(mydataAno)-1)]
  meAno_bio[[i]] <- ksvm(as.numeric(Anogeissus)~., mydataAno[trainSet, ], na.action=na.omit)
  eAno_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAno_bio[[i]])
  testpres <- mydataAnoVar[mydataAnoVar[testSet,ncol(mydataAnoVar)] == 1, 1:ncol(mydataAnoVar)-1]
  testbackg <- mydataAnoVar[mydataAnoVar[testSet,ncol(mydataAnoVar)] == 0, 1:ncol(mydataAnoVar)-1]
  meAno_Var[[i]] <- ksvm(as.numeric(Anogeissus)~., mydataAnoVar[trainSet, ], na.action=na.omit)
  eAno_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAno_Var[[i]])
}
RandomForestpredAnogeissusbio<-list()
RandomForestpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
RandomForestpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
RandomForestpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusbio[["PresenceAbsence"]]<-RandomForestpredAnogeissusbio[[espece[3]]]>RandomForestpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
RandomForestpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
RandomForestpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusvar[["PresenceAbsence"]]<-RandomForestpredAnogeissusvar[[espece[3]]]>RandomForestpredAnogeissusvar[["threshold"]]
#plot(RandomForestpredAnogeissusvar[[espece[2]]]>RandomForestpredAnogeissusvar[["threshold"]])
ggR_Predict2(RandomForestpredAnogeissusbio[[espece[3]]],RandomForestpredAnogeissusvar[[espece[3]]])
```


#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
folds<-spatialBlock[[4]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAdan[mydataAdan[testSet,ncol(mydataAdan)] == 1, 1:(ncol(mydataAdan)-1)]
  testbackg <- mydataAdan[mydataAdan[testSet,ncol(mydataAdan)] == 0, 1:(ncol(mydataAdan)-1)]
  meAdan_bio[[i]] <- ksvm(as.numeric(Adansonia)~., mydataAdan[trainSet, ], na.action=na.omit)
  eAdan_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_bio[[i]])
  testpres <- mydataAdanVar[mydataAdanVar[testSet,ncol(mydataAdanVar)] == 1, 1:ncol(mydataAdanVar)-1]
  testbackg <- mydataAdanVar[mydataAdanVar[testSet,ncol(mydataAdanVar)] == 0, 1:ncol(mydataAdanVar)-1]
  meAdan_Var[[i]] <- ksvm(as.numeric(Adansonia)~., mydataAdanVar[trainSet, ], na.action=na.omit)
  eAdan_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_Var[[i]])
}
RandomForestpredAdansoniabio<-list()
RandomForestpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
RandomForestpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
RandomForestpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniabio[["PresenceAbsence"]]<-RandomForestpredAdansoniabio[[espece[4]]]>RandomForestpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
RandomForestpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
RandomForestpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniavar[["PresenceAbsence"]]<-RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]]
#plot(RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]])
ggR_Predict2(RandomForestpredAdansoniabio[[espece[4]]],RandomForestpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
folds<-spatialBlock[[5]]$folds
for (i in 1:5) {
  trainSet <- unlist(folds[[i]][1]) # training set indices
  testSet <- unlist(folds[[i]][2]) # testing set indices
  testpres <- mydataAca[mydataAca[testSet,ncol(mydataAca)] == 1, 1:(ncol(mydataAca)-1)]
  testbackg <- mydataAca[mydataAca[testSet,ncol(mydataAca)] == 0, 1:(ncol(mydataAca)-1)]
  meAca_bio[[i]] <- ksvm(as.numeric(Acacia)~., mydataAca[trainSet, ], na.action=na.omit)
  eAca_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAca_bio[[i]])
  testpres <- mydataAcaVar[mydataAcaVar[testSet,ncol(mydataAcaVar)] == 1, 1:ncol(mydataAcaVar)-1]
  testbackg <- mydataAcaVar[mydataAcaVar[testSet,ncol(mydataAcaVar)] == 0, 1:ncol(mydataAcaVar)-1]
  meAca_Var[[i]] <- ksvm(as.numeric(Acacia)~., mydataAcaVar[trainSet, ], na.action=na.omit)
  eAca_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAca_Var[[i]])
}
RandomForestpredAcaciabio<-list()
RandomForestpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
RandomForestpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
RandomForestpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciabio[["PresenceAbsence"]]<-RandomForestpredAcaciabio[[espece[5]]]>RandomForestpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
RandomForestpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
RandomForestpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciavar[["PresenceAbsence"]]<-RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]]
#plot(RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]])
ggR_Predict2(RandomForestpredAcaciabio[[espece[5]]],RandomForestpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"svm"
Evaluation$blocs<-"Oui"
write.csv2(Evaluation,"EvaluationSVM")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```





# Modelisation de la distribution des Especes sans les blocs spatiaux
```{r echo=FALSE, message=FALSE, warning=FALSE}
set.seed(1994)
# witholding a 20% sample for testing 
fold<-kfold(Base$`Faidherbia albida`,5)

```
### Maxent
#### Faidherbia albida


```{r echo=FALSE, message=FALSE, warning=FALSE}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")

for (i in 1:5) {
  
  
  train<-Base_Faidherbia_Z[fold != i, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  me_bio[[i]] <- dismo::maxent(var_explibio$`Faidherbia albida`, p, a) #, factors='Sol'
  me_Var[[i]] <- dismo::maxent(var_expli$`Faidherbia albida`, p, a) #, factors='Sol'
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
}

MaxentpredFaidherbiabio<-list()
MaxentpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
MaxentpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
MaxentpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
MaxentpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
MaxentpredFaidherbiabio[["PresenceAbsence"]]<-MaxentpredFaidherbiabio[[espece[1]]]>MaxentpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
MaxentpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
MaxentpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
MaxentpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
MaxentpredFaidherbiavar[["PresenceAbsence"]]<-MaxentpredFaidherbiavar[[espece[1]]]>MaxentpredFaidherbiavar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]]>MaxentpredFaidherbiavar[["threshold"]])
ggR_Predict2(MaxentpredFaidherbiabio[[espece[1]]],MaxentpredFaidherbiavar[[espece[1]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# PASpecies2(MaxentpredFaidherbiabio[["PresenceAbsence"]],MaxentpredFaidherbiavar[["PresenceAbsence"]])
```

#### Balanites aegyptiaca

```{r echo=FALSE, message=FALSE, warning=FALSE}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")

for (i in 1:5) {
  
  
  train<-Base_Balanites_Z[fold != i, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- maxent(var_explibio$`Balanites aegyptiaca`, p, a) #, factors='Sol'
  meB_Var[[i]] <- maxent(var_expli$`Balanites aegyptiaca`, p, a) #, factors='Sol'
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
MaxentpredBalanitesbio<-list()
MaxentpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
MaxentpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
MaxentpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
MaxentpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
MaxentpredBalanitesbio[["PresenceAbsence"]]<-MaxentpredBalanitesbio[[espece[2]]]>MaxentpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
MaxentpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
MaxentpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
MaxentpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
MaxentpredBalanitesvar[["PresenceAbsence"]]<-MaxentpredBalanitesvar[[espece[2]]]>MaxentpredBalanitesvar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]])
 ggR_Predict2(MaxentpredBalanitesbio[[espece[2]]],MaxentpredBalanitesvar[[espece[2]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredBalanitesbio[["PresenceAbsence"]],MaxentpredBalanitesvar[["PresenceAbsence"]])
```


#### Anogeissus


```{r echo=FALSE, message=FALSE, warning=FALSE}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")

for (i in 1:5) {
  
  
  train<-Base_Anogeissus_Z[fold != i, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- maxent(var_explibio$`Anogeissus leiocarpus`, p, a) #, factors='Sol'
  meAno_Var[[i]] <- maxent(var_expli$`Anogeissus leiocarpus`, p, a) #, factors='Sol'
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
MaxentpredAnogeissusbio<-list()
MaxentpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
MaxentpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
MaxentpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
MaxentpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
MaxentpredAnogeissusbio[["PresenceAbsence"]]<-MaxentpredAnogeissusbio[[espece[3]]]>MaxentpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
MaxentpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
MaxentpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
MaxentpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
MaxentpredAnogeissusvar[["PresenceAbsence"]]<-MaxentpredAnogeissusvar[[espece[3]]]>MaxentpredAnogeissusvar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]])
ggR_Predict2(MaxentpredAnogeissusbio[[espece[3]]],MaxentpredAnogeissusvar[[espece[3]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredAnogeissusbio[["PresenceAbsence"]],MaxentpredAnogeissusvar[["PresenceAbsence"]])
```

#### Adansonia

```{r echo=FALSE, message=FALSE, warning=FALSE}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")

for (i in 1:5) {
  
  
  train<-Base_Adansonia_Z[fold != i, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- maxent(var_explibio$`Adansonia digitata`, p, a) #, factors='Sol'
  meAdan_Var[[i]] <- maxent(var_expli$`Adansonia digitata`, p, a) #, factors='Sol'
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
MaxentpredAdansoniabio<-list()
MaxentpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
MaxentpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
MaxentpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
MaxentpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
MaxentpredAdansoniabio[["PresenceAbsence"]]<-MaxentpredAdansoniabio[[espece[4]]]>MaxentpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
MaxentpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
MaxentpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
MaxentpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
MaxentpredAdansoniavar[["PresenceAbsence"]]<-MaxentpredAdansoniavar[[espece[4]]]>MaxentpredAdansoniavar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]])
ggR_Predict2(MaxentpredAdansoniabio[[espece[4]]],MaxentpredAdansoniavar[[espece[4]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
 PASpecies2(MaxentpredAdansoniabio[["PresenceAbsence"]],MaxentpredAdansoniavar[["PresenceAbsence"]])
```

#### Acacia



```{r echo=FALSE, message=FALSE, warning=FALSE}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")

for (i in 1:5) {
  
  
  train<-Base_Acacia_Z[fold != i, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- maxent(var_explibio$`Acacia nilotica`, p, a) #, factors='Sol'
  meAca_Var[[i]] <- maxent(var_expli$`Acacia nilotica`, p, a) #, factors='Sol'
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
MaxentpredAcaciabio<-list()
MaxentpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
MaxentpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
MaxentpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
MaxentpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
MaxentpredAcaciabio[["PresenceAbsence"]]<-MaxentpredAcaciabio[[espece[5]]]>MaxentpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
MaxentpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
MaxentpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
MaxentpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
MaxentpredAcaciavar[["PresenceAbsence"]]<-MaxentpredAcaciavar[[espece[5]]]>MaxentpredAcaciavar[["threshold"]]
#plot(MaxentpredFaidherbiavar[[espece[1]]])
ggR_Predict2(MaxentpredAcaciabio[[espece[5]]],MaxentpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
PASpecies2(MaxentpredAcaciabio[["PresenceAbsence"]],MaxentpredAcaciavar[["PresenceAbsence"]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))

Evaluation$Type<-"MaxEnt"
Evaluation$blocs<-"Non"
write.csv2(Evaluation,"EvaluationMaxEnt2")

p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) 
```

###bioclim
####Faidherbia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")

for (i in 1:5) {
  
  
  train<-Base_Faidherbia_Z[fold != i, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  
  me_bio[[i]] <- dismo::bioclim(var_explibio$`Faidherbia albida`, p)
  me_Var[[i]] <-dismo::bioclim(var_expli$`Faidherbia albida`, p)
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
  
}
bioclimpredFaidherbiabio<-list()
bioclimpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
bioclimpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
bioclimpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiabio[["PresenceAbsence"]]<-bioclimpredFaidherbiabio[[espece[1]]]>bioclimpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
bioclimpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
bioclimpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiavar[["PresenceAbsence"]]<-bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]])
ggR_Predict2(bioclimpredFaidherbiabio[[espece[1]]],bioclimpredFaidherbiavar[[espece[1]]])

```

#### Balanites
```{r echo=FALSE, message=FALSE, warning=FALSE}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")

for (i in 1:5) {
  
  
  train<-Base_Balanites_Z[fold != i, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- dismo::bioclim(var_explibio$`Balanites aegyptiaca`, p)
  meB_Var[[i]] <-dismo::bioclim(var_expli$`Balanites aegyptiaca`, p)
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
bioclimpredBalanitesbio<-list()
bioclimpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
bioclimpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
bioclimpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesbio[["PresenceAbsence"]]<-bioclimpredBalanitesbio[[espece[2]]]>bioclimpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
bioclimpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
bioclimpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesvar[["PresenceAbsence"]]<-bioclimpredBalanitesvar[[espece[2]]]>bioclimpredBalanitesvar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]])
 ggR_Predict2(bioclimpredBalanitesbio[[espece[2]]],bioclimpredBalanitesvar[[espece[2]]])
```

### Anogeissus

```{r echo=FALSE, message=FALSE, warning=FALSE}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")

for (i in 1:5) {
  
  
  train<-Base_Anogeissus_Z[fold != i, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- dismo::bioclim(var_explibio$`Anogeissus leiocarpus`, p)
  meAno_Var[[i]] <- dismo::bioclim(var_expli$`Anogeissus leiocarpus`, p)
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
bioclimpredAnogeissusbio<-list()
bioclimpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
bioclimpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
bioclimpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusbio[["PresenceAbsence"]]<-bioclimpredAnogeissusbio[[espece[3]]]>bioclimpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
bioclimpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
bioclimpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusvar[["PresenceAbsence"]]<-bioclimpredAnogeissusvar[[espece[3]]]>bioclimpredAnogeissusvar[["threshold"]]
#plot(bioclimpredAnogeissusvar[[espece[2]]]>bioclimpredAnogeissusvar[["threshold"]])
ggR_Predict2(bioclimpredAnogeissusbio[[espece[3]]],bioclimpredAnogeissusvar[[espece[3]]])
```


#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")

for (i in 1:5) {
  
  
  train<-Base_Adansonia_Z[fold != i, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- dismo::bioclim(var_explibio$`Adansonia digitata`, p)
  meAdan_Var[[i]] <- dismo::bioclim(var_expli$`Adansonia digitata`, p)
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
bioclimpredAdansoniabio<-list()
bioclimpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
bioclimpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
bioclimpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniabio[["PresenceAbsence"]]<-bioclimpredAdansoniabio[[espece[4]]]>bioclimpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
bioclimpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
bioclimpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniavar[["PresenceAbsence"]]<-bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]]
#plot(bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]])
ggR_Predict2(bioclimpredAdansoniabio[[espece[4]]],bioclimpredAdansoniavar[[espece[4]]])
```


#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")

for (i in 1:5) {
  
  
  train<-Base_Acacia_Z[fold != i, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- dismo::bioclim(var_explibio$`Acacia nilotica`, p)
  meAca_Var[[i]] <- dismo::bioclim(var_expli$`Acacia nilotica`, p)
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
bioclimpredAcaciabio<-list()
bioclimpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
bioclimpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
bioclimpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciabio[["PresenceAbsence"]]<-bioclimpredAcaciabio[[espece[5]]]>bioclimpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
bioclimpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
bioclimpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciavar[["PresenceAbsence"]]<-bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]]
#plot(bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]])
ggR_Predict2(bioclimpredAcaciabio[[espece[5]]],bioclimpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"bioclim"
Evaluation$blocs<-"Non"
write.csv2(Evaluation,"Evaluationbioclim2")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### Modèle domain
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")

for (i in 1:5) {
  
  
  train<-Base_Faidherbia_Z[fold != i, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  
  me_bio[[i]] <- dismo::domain(var_explibio$`Faidherbia albida`, p)
  me_Var[[i]] <-dismo::domain(var_expli$`Faidherbia albida`, p)
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
  
}
bioclimpredFaidherbiabio<-list()
bioclimpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
bioclimpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
bioclimpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiabio[["PresenceAbsence"]]<-bioclimpredFaidherbiabio[[espece[1]]]>bioclimpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
bioclimpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
bioclimpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiavar[["PresenceAbsence"]]<-bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]])
ggR_Predict2(bioclimpredFaidherbiabio[[espece[1]]],bioclimpredFaidherbiavar[[espece[1]]])
```

#### Balanites

```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")

for (i in 1:5) {
  
  
  train<-Base_Balanites_Z[fold != i, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- dismo::domain(var_explibio$`Balanites aegyptiaca`, p)
  meB_Var[[i]] <-dismo::domain(var_expli$`Balanites aegyptiaca`, p)
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
bioclimpredBalanitesbio<-list()
bioclimpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
bioclimpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
bioclimpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesbio[["PresenceAbsence"]]<-bioclimpredBalanitesbio[[espece[2]]]>bioclimpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
bioclimpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
bioclimpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesvar[["PresenceAbsence"]]<-bioclimpredBalanitesvar[[espece[2]]]>bioclimpredBalanitesvar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]])
 ggR_Predict2(bioclimpredBalanitesbio[[espece[2]]],bioclimpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")

for (i in 1:5) {
  
  
  train<-Base_Anogeissus_Z[fold != i, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- dismo::domain(var_explibio$`Anogeissus leiocarpus`, p)
  meAno_Var[[i]] <- dismo::domain(var_expli$`Anogeissus leiocarpus`, p)
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
bioclimpredAnogeissusbio<-list()
bioclimpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
bioclimpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
bioclimpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusbio[["PresenceAbsence"]]<-bioclimpredAnogeissusbio[[espece[3]]]>bioclimpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
bioclimpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
bioclimpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusvar[["PresenceAbsence"]]<-bioclimpredAnogeissusvar[[espece[3]]]>bioclimpredAnogeissusvar[["threshold"]]
#plot(bioclimpredAnogeissusvar[[espece[2]]]>bioclimpredAnogeissusvar[["threshold"]])
ggR_Predict2(bioclimpredAnogeissusbio[[espece[3]]],bioclimpredAnogeissusvar[[espece[3]]])
```

#### Adansonia

```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")

for (i in 1:5) {
  
  
  train<-Base_Adansonia_Z[fold != i, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- dismo::domain(var_explibio$`Adansonia digitata`, p)
  meAdan_Var[[i]] <- dismo::domain(var_expli$`Adansonia digitata`, p)
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
bioclimpredAdansoniabio<-list()
bioclimpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
bioclimpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
bioclimpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniabio[["PresenceAbsence"]]<-bioclimpredAdansoniabio[[espece[4]]]>bioclimpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
bioclimpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
bioclimpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniavar[["PresenceAbsence"]]<-bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]]
#plot(bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]])
ggR_Predict2(bioclimpredAdansoniabio[[espece[4]]],bioclimpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")

for (i in 1:5) {
  
  
  train<-Base_Acacia_Z[fold != i, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- dismo::domain(var_explibio$`Acacia nilotica`, p)
  meAca_Var[[i]] <- dismo::domain(var_expli$`Acacia nilotica`, p)
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
bioclimpredAcaciabio<-list()
bioclimpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
bioclimpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
bioclimpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciabio[["PresenceAbsence"]]<-bioclimpredAcaciabio[[espece[5]]]>bioclimpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
bioclimpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
bioclimpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciavar[["PresenceAbsence"]]<-bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]]
#plot(bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]])
ggR_Predict2(bioclimpredAcaciabio[[espece[5]]],bioclimpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"domain"
Evaluation$blocs<-"Non"
write.csv2(Evaluation,"Evaluationdomain2")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### Modèle mahal
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()
Base_Faidherbia_Z<-Base$`Faidherbia albida`
names(Base_Faidherbia_Z)<-c("lon","lat","Faidherbia")

for (i in 1:5) {
  
  
  train<-Base_Faidherbia_Z[fold != i, ] 
  p<-train %>% 
    filter(Faidherbia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Faidherbia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Faidherbia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Faidherbia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Faidherbia==0)
  bgtest<-bgtest[,c("lon","lat")]
  
  me_bio[[i]] <- dismo::mahal(var_explibio$`Faidherbia albida`, p)
  me_Var[[i]] <-dismo::mahal(var_expli$`Faidherbia albida`, p)
  eF_bio[[i]] <- dismo::evaluate(occtest, bgtest, me_bio[[i]], var_explibio$`Faidherbia albida`)
  eF_Var[[i]] <- dismo::evaluate(occtest, bgtest,  me_Var[[i]], var_expli$`Faidherbia albida`)
  
}
bioclimpredFaidherbiabio<-list()
bioclimpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
bioclimpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
bioclimpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiabio[["PresenceAbsence"]]<-bioclimpredFaidherbiabio[[espece[1]]]>bioclimpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
bioclimpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
bioclimpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
bioclimpredFaidherbiavar[["PresenceAbsence"]]<-bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]]>bioclimpredFaidherbiavar[["threshold"]])
ggR_Predict2(bioclimpredFaidherbiabio[[espece[1]]],bioclimpredFaidherbiavar[[espece[1]]])
```

#### Balanites

```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()
Base_Balanites_Z<-Base$`Balanites aegyptiaca`
names(Base_Balanites_Z)<-c("lon","lat","Balanites")

for (i in 1:5) {
  
  
  train<-Base_Balanites_Z[fold != i, ] 
  p<-train %>% 
    filter(Balanites==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Balanites==0)
  a<-a[,c("lon","lat")]
  test<-Base_Balanites_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Balanites==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Balanites==0)
  bgtest<-bgtest[,c("lon","lat")]
  meB_bio[[i]] <- dismo::mahal(var_explibio$`Balanites aegyptiaca`, p)
  meB_Var[[i]] <-dismo::mahal(var_expli$`Balanites aegyptiaca`, p)
  eB_bio[[i]] <- evaluate(occtest, bgtest, meB_bio[[i]], var_explibio$`Balanites aegyptiaca`)
  eB_Var[[i]] <- evaluate(occtest, bgtest,  meB_Var[[i]], var_expli$`Balanites aegyptiaca`)
  
}
bioclimpredBalanitesbio<-list()
bioclimpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
bioclimpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
bioclimpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesbio[["PresenceAbsence"]]<-bioclimpredBalanitesbio[[espece[2]]]>bioclimpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
bioclimpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
bioclimpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
bioclimpredBalanitesvar[["PresenceAbsence"]]<-bioclimpredBalanitesvar[[espece[2]]]>bioclimpredBalanitesvar[["threshold"]]
#plot(bioclimpredFaidherbiavar[[espece[1]]])
 ggR_Predict2(bioclimpredBalanitesbio[[espece[2]]],bioclimpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()
Base_Anogeissus_Z<-Base$`Anogeissus leiocarpus`
names(Base_Anogeissus_Z)<-c("lon","lat","Anogeissus")

for (i in 1:5) {
  
  
  train<-Base_Anogeissus_Z[fold != i, ] 
  p<-train %>% 
    filter(Anogeissus==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Anogeissus==0)
  a<-a[,c("lon","lat")]
  test<-Base_Anogeissus_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Anogeissus==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Anogeissus==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAno_bio[[i]] <- dismo::mahal(var_explibio$`Anogeissus leiocarpus`, p)
  meAno_Var[[i]] <- dismo::mahal(var_expli$`Anogeissus leiocarpus`, p)
  eAno_bio[[i]] <- evaluate(occtest, bgtest, meAno_bio[[i]], var_explibio$`Anogeissus leiocarpus`)
  eAno_Var[[i]] <- evaluate(occtest, bgtest,  meAno_Var[[i]], var_expli$`Anogeissus leiocarpus`)
  
}
bioclimpredAnogeissusbio<-list()
bioclimpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
bioclimpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
bioclimpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusbio[["PresenceAbsence"]]<-bioclimpredAnogeissusbio[[espece[3]]]>bioclimpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
bioclimpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
bioclimpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAnogeissusvar[["PresenceAbsence"]]<-bioclimpredAnogeissusvar[[espece[3]]]>bioclimpredAnogeissusvar[["threshold"]]
#plot(bioclimpredAnogeissusvar[[espece[2]]]>bioclimpredAnogeissusvar[["threshold"]])
ggR_Predict2(bioclimpredAnogeissusbio[[espece[3]]],bioclimpredAnogeissusvar[[espece[3]]])
```

#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()
Base_Adansonia_Z<-Base$`Adansonia digitata`
names(Base_Adansonia_Z)<-c("lon","lat","Adansonia")

for (i in 1:5) {
  
  
  train<-Base_Adansonia_Z[fold != i, ] 
  p<-train %>% 
    filter(Adansonia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Adansonia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Adansonia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Adansonia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Adansonia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAdan_bio[[i]] <- dismo::mahal(var_explibio$`Adansonia digitata`, p)
  meAdan_Var[[i]] <- dismo::mahal(var_expli$`Adansonia digitata`, p)
  eAdan_bio[[i]] <- evaluate(occtest, bgtest, meAdan_bio[[i]], var_explibio$`Adansonia digitata`)
  eAdan_Var[[i]] <- evaluate(occtest, bgtest,  meAdan_Var[[i]], var_expli$`Adansonia digitata`)
  
}
bioclimpredAdansoniabio<-list()
bioclimpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
bioclimpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
bioclimpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniabio[["PresenceAbsence"]]<-bioclimpredAdansoniabio[[espece[4]]]>bioclimpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
bioclimpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
bioclimpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAdansoniavar[["PresenceAbsence"]]<-bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]]
#plot(bioclimpredAdansoniavar[[espece[4]]]>bioclimpredAdansoniavar[["threshold"]])
ggR_Predict2(bioclimpredAdansoniabio[[espece[4]]],bioclimpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()
Base_Acacia_Z<-Base$`Acacia nilotica`
names(Base_Acacia_Z)<-c("lon","lat","Acacia")

for (i in 1:5) {
  
  
  train<-Base_Acacia_Z[fold != i, ] 
  p<-train %>% 
    filter(Acacia==1)
  p<-p[,c("lon","lat")]
  a<-train %>% 
    filter(Acacia==0)
  a<-a[,c("lon","lat")]
  test<-Base_Acacia_Z[fold == i, ] 
  occtest<-test %>% 
    filter(Acacia==1)
  occtest<-occtest[,c("lon","lat")] 
  bgtest<-test %>% 
    filter(Acacia==0)
  bgtest<-bgtest[,c("lon","lat")]
  meAca_bio[[i]] <- dismo::mahal(var_explibio$`Acacia nilotica`, p)
  meAca_Var[[i]] <- dismo::mahal(var_expli$`Acacia nilotica`, p)
  eAca_bio[[i]] <- evaluate(occtest, bgtest, meAca_bio[[i]], var_explibio$`Acacia nilotica`)
  eAca_Var[[i]] <- evaluate(occtest, bgtest,  meAca_Var[[i]], var_expli$`Acacia nilotica`)
  
}
bioclimpredAcaciabio<-list()
bioclimpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
bioclimpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
bioclimpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciabio[["PresenceAbsence"]]<-bioclimpredAcaciabio[[espece[5]]]>bioclimpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
bioclimpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
bioclimpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
bioclimpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
bioclimpredAcaciavar[["PresenceAbsence"]]<-bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]]
#plot(bioclimpredAcaciavar[[espece[5]]]>bioclimpredAcaciavar[["threshold"]])
ggR_Predict2(bioclimpredAcaciabio[[espece[5]]],bioclimpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"mahal"
Evaluation$blocs<-"Non"
write.csv2(Evaluation,"Evaluationmahal2")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```



### RandomForest
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataF[mydataF[fold == i,ncol(mydataF)] == 1, 1:(ncol(mydataF)-1)]
  testbackg <- mydataF[mydataF[fold == i,ncol(mydataF)] == 0, 1:(ncol(mydataF)-1)]
  me_bio[[i]] <- randomForest(as.numeric(Faidherbia)~., mydataF[fold != i, ], na.action=na.omit)
  eF_bio[[i]] <- dismo::evaluate(testpres, testbackg, me_bio[[i]])
  testpres <- mydataFVar[mydataFVar[fold == i,ncol(mydataFVar)] == 1, 1:ncol(mydataFVar)-1]
  testbackg <- mydataFVar[mydataFVar[fold == i,ncol(mydataFVar)] == 0, 1:ncol(mydataFVar)-1]
  me_Var[[i]] <- randomForest(as.numeric(Faidherbia)~., mydataFVar[fold != i, ], na.action=na.omit)
  eF_Var[[i]] <- dismo::evaluate(testpres, testbackg, me_Var[[i]])
}
RandomForestpredFaidherbiabio<-list()
RandomForestpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
RandomForestpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
RandomForestpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiabio[["PresenceAbsence"]]<-RandomForestpredFaidherbiabio[[espece[1]]]>RandomForestpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
RandomForestpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
RandomForestpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiavar[["PresenceAbsence"]]<-RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]]
#plot(RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]])
ggR_Predict2(RandomForestpredFaidherbiabio[[espece[1]]],RandomForestpredFaidherbiavar[[espece[1]]])
```


#### Balanites
```{r echo=FALSE, message=FALSE, warning=FALSE}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataB[mydataB[fold == i,ncol(mydataB)] == 1, 1:(ncol(mydataB)-1)]
  testbackg <- mydataB[mydataB[fold == i,ncol(mydataB)] == 0, 1:(ncol(mydataB)-1)]
  meB_bio[[i]] <- randomForest(as.numeric(Balanites)~., mydataB[fold != i, ], na.action=na.omit)
  eB_bio[[i]] <- dismo::evaluate(testpres, testbackg, meB_bio[[i]])
  testpres <- mydataBVar[mydataBVar[fold == i,ncol(mydataBVar)] == 1, 1:ncol(mydataBVar)-1]
  testbackg <- mydataBVar[mydataBVar[fold == i,ncol(mydataBVar)] == 0, 1:ncol(mydataBVar)-1]
  meB_Var[[i]] <- randomForest(as.numeric(Balanites)~., mydataBVar[fold != i, ], na.action=na.omit)
  eB_Var[[i]] <- dismo::evaluate(testpres, testbackg, meB_Var[[i]])
}
RandomForestpredBalanitesbio<-list()
RandomForestpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
RandomForestpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
RandomForestpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesbio[["PresenceAbsence"]]<-RandomForestpredBalanitesbio[[espece[2]]]>RandomForestpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
RandomForestpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
RandomForestpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesvar[["PresenceAbsence"]]<-RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]]
#plot(RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]])
ggR_Predict2(RandomForestpredBalanitesbio[[espece[2]]],RandomForestpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r echo=FALSE, message=FALSE, warning=FALSE}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAno[mydataAno[fold == i,ncol(mydataAno)] == 1, 1:(ncol(mydataAno)-1)]
  testbackg <- mydataAno[mydataAno[fold == i,ncol(mydataAno)] == 0, 1:(ncol(mydataAno)-1)]
  meAno_bio[[i]] <- randomForest(as.numeric(Anogeissus)~., mydataAno[fold != i, ], na.action=na.omit)
  eAno_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAno_bio[[i]])
  testpres <- mydataAnoVar[mydataAnoVar[fold == i,ncol(mydataAnoVar)] == 1, 1:ncol(mydataAnoVar)-1]
  testbackg <- mydataAnoVar[mydataAnoVar[fold == i,ncol(mydataAnoVar)] == 0, 1:ncol(mydataAnoVar)-1]
  meAno_Var[[i]] <- randomForest(as.numeric(Anogeissus)~., mydataAnoVar[fold != i, ], na.action=na.omit)
  eAno_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAno_Var[[i]])
}
RandomForestpredAnogeissusbio<-list()
RandomForestpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
RandomForestpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
RandomForestpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusbio[["PresenceAbsence"]]<-RandomForestpredAnogeissusbio[[espece[3]]]>RandomForestpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
RandomForestpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
RandomForestpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusvar[["PresenceAbsence"]]<-RandomForestpredAnogeissusvar[[espece[3]]]>RandomForestpredAnogeissusvar[["threshold"]]
#plot(RandomForestpredAnogeissusvar[[espece[2]]]>RandomForestpredAnogeissusvar[["threshold"]])
ggR_Predict2(RandomForestpredAnogeissusbio[[espece[3]]],RandomForestpredAnogeissusvar[[espece[3]]])
```

#### Adansonia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAdan[mydataAdan[fold == i,ncol(mydataAdan)] == 1, 1:(ncol(mydataAdan)-1)]
  testbackg <- mydataAdan[mydataAdan[fold == i,ncol(mydataAdan)] == 0, 1:(ncol(mydataAdan)-1)]
  meAdan_bio[[i]] <- randomForest(as.numeric(Adansonia)~., mydataAdan[fold != i, ], na.action=na.omit)
  eAdan_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_bio[[i]])
  testpres <- mydataAdanVar[mydataAdanVar[fold == i,ncol(mydataAdanVar)] == 1, 1:ncol(mydataAdanVar)-1]
  testbackg <- mydataAdanVar[mydataAdanVar[fold == i,ncol(mydataAdanVar)] == 0, 1:ncol(mydataAdanVar)-1]
  meAdan_Var[[i]] <- randomForest(as.numeric(Adansonia)~., mydataAdanVar[fold != i, ], na.action=na.omit)
  eAdan_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_Var[[i]])
}
RandomForestpredAdansoniabio<-list()
RandomForestpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
RandomForestpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
RandomForestpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniabio[["PresenceAbsence"]]<-RandomForestpredAdansoniabio[[espece[4]]]>RandomForestpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
RandomForestpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
RandomForestpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniavar[["PresenceAbsence"]]<-RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]]
#plot(RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]])
ggR_Predict2(RandomForestpredAdansoniabio[[espece[4]]],RandomForestpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAca[mydataAca[fold == i,ncol(mydataAca)] == 1, 1:(ncol(mydataAca)-1)]
  testbackg <- mydataAca[mydataAca[fold == i,ncol(mydataAca)] == 0, 1:(ncol(mydataAca)-1)]
  meAca_bio[[i]] <- randomForest(as.numeric(Acacia)~., mydataAca[fold != i, ], na.action=na.omit)
  eAca_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAca_bio[[i]])
  testpres <- mydataAcaVar[mydataAcaVar[fold == i,ncol(mydataAcaVar)] == 1, 1:ncol(mydataAcaVar)-1]
  testbackg <- mydataAcaVar[mydataAcaVar[fold == i,ncol(mydataAcaVar)] == 0, 1:ncol(mydataAcaVar)-1]
  meAca_Var[[i]] <- randomForest(as.numeric(Acacia)~., mydataAcaVar[fold != i, ], na.action=na.omit)
  eAca_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAca_Var[[i]])
}
RandomForestpredAcaciabio<-list()
RandomForestpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
RandomForestpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
RandomForestpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciabio[["PresenceAbsence"]]<-RandomForestpredAcaciabio[[espece[5]]]>RandomForestpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
RandomForestpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
RandomForestpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciavar[["PresenceAbsence"]]<-RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]]
#plot(RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]])
ggR_Predict2(RandomForestpredAcaciabio[[espece[5]]],RandomForestpredAcaciavar[[espece[5]]])
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"RF"
Evaluation$blocs<-"Non"
write_csv2(Evaluation,"EvaluationRF2")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### GLM
#### Faidherbia
```{r echo=FALSE, message=FALSE, warning=FALSE}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataF[mydataF[fold == i,ncol(mydataF)] == 1, 1:(ncol(mydataF)-1)]
  testbackg <- mydataF[mydataF[fold == i,ncol(mydataF)] == 0, 1:(ncol(mydataF)-1)]
  me_bio[[i]] <- glm(Faidherbia~., mydataF[fold != i, ], na.action=na.omit,
                     family = binomial(link = "logit"))
  eF_bio[[i]] <- dismo::evaluate(testpres, testbackg, me_bio[[i]])
  testpres <- mydataFVar[mydataFVar[fold == i,ncol(mydataFVar)] == 1, 1:ncol(mydataFVar)-1]
  testbackg <- mydataFVar[mydataFVar[fold == i,ncol(mydataFVar)] == 0, 1:ncol(mydataFVar)-1]
  me_Var[[i]] <- glm(Faidherbia~., mydataFVar[fold != i, ],
                     family = binomial(link = "logit"), na.action=na.omit)
  eF_Var[[i]] <- dismo::evaluate(testpres, testbackg, me_Var[[i]])
}
RandomForestpredFaidherbiabio<-list()
RandomForestpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
RandomForestpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
RandomForestpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiabio[["PresenceAbsence"]]<-RandomForestpredFaidherbiabio[[espece[1]]]>RandomForestpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
RandomForestpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
RandomForestpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiavar[["PresenceAbsence"]]<-RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]]
#plot(RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]])
ggR_Predict2(RandomForestpredFaidherbiabio[[espece[1]]],RandomForestpredFaidherbiavar[[espece[1]]])
```

#### Balanites
```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataB[mydataB[fold == i,ncol(mydataB)] == 1, 1:(ncol(mydataB)-1)]
  testbackg <- mydataB[mydataB[fold == i,ncol(mydataB)] == 0, 1:(ncol(mydataB)-1)]
  meB_bio[[i]] <- glm(Balanites~., mydataB[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eB_bio[[i]] <- dismo::evaluate(testpres, testbackg, meB_bio[[i]])
  testpres <- mydataBVar[mydataBVar[fold == i,ncol(mydataBVar)] == 1, 1:ncol(mydataBVar)-1]
  testbackg <- mydataBVar[mydataBVar[fold == i,ncol(mydataBVar)] == 0, 1:ncol(mydataBVar)-1]
  meB_Var[[i]] <- glm(Balanites~., mydataBVar[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eB_Var[[i]] <- dismo::evaluate(testpres, testbackg, meB_Var[[i]])
}
RandomForestpredBalanitesbio<-list()
RandomForestpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
RandomForestpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
RandomForestpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesbio[["PresenceAbsence"]]<-RandomForestpredBalanitesbio[[espece[2]]]>RandomForestpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
RandomForestpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
RandomForestpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesvar[["PresenceAbsence"]]<-RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]]
#plot(RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]])
ggR_Predict2(RandomForestpredBalanitesbio[[espece[2]]],RandomForestpredBalanitesvar[[espece[2]]])
```

#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAno[mydataAno[fold == i,ncol(mydataAno)] == 1, 1:(ncol(mydataAno)-1)]
  testbackg <- mydataAno[mydataAno[fold == i,ncol(mydataAno)] == 0, 1:(ncol(mydataAno)-1)]
  meAno_bio[[i]] <- glm(Anogeissus~., mydataAno[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eAno_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAno_bio[[i]])
  testpres <- mydataAnoVar[mydataAnoVar[fold == i,ncol(mydataAnoVar)] == 1, 1:ncol(mydataAnoVar)-1]
  testbackg <- mydataAnoVar[mydataAnoVar[fold == i,ncol(mydataAnoVar)] == 0, 1:ncol(mydataAnoVar)-1]
  meAno_Var[[i]] <- glm(Anogeissus~., mydataAnoVar[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eAno_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAno_Var[[i]])
}
RandomForestpredAnogeissusbio<-list()
RandomForestpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
RandomForestpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
RandomForestpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusbio[["PresenceAbsence"]]<-RandomForestpredAnogeissusbio[[espece[3]]]>RandomForestpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
RandomForestpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
RandomForestpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusvar[["PresenceAbsence"]]<-RandomForestpredAnogeissusvar[[espece[3]]]>RandomForestpredAnogeissusvar[["threshold"]]
#plot(RandomForestpredAnogeissusvar[[espece[2]]]>RandomForestpredAnogeissusvar[["threshold"]])
ggR_Predict2(RandomForestpredAnogeissusbio[[espece[3]]],RandomForestpredAnogeissusvar[[espece[3]]])
```

#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAdan[mydataAdan[fold == i,ncol(mydataAdan)] == 1, 1:(ncol(mydataAdan)-1)]
  testbackg <- mydataAdan[mydataAdan[fold == i,ncol(mydataAdan)] == 0, 1:(ncol(mydataAdan)-1)]
  meAdan_bio[[i]] <- glm(Adansonia~., mydataAdan[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eAdan_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_bio[[i]])
  testpres <- mydataAdanVar[mydataAdanVar[fold == i,ncol(mydataAdanVar)] == 1, 1:ncol(mydataAdanVar)-1]
  testbackg <- mydataAdanVar[mydataAdanVar[fold == i,ncol(mydataAdanVar)] == 0, 1:ncol(mydataAdanVar)-1]
  meAdan_Var[[i]] <- glm(Adansonia~., mydataAdanVar[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eAdan_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_Var[[i]])
}
RandomForestpredAdansoniabio<-list()
RandomForestpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
RandomForestpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
RandomForestpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniabio[["PresenceAbsence"]]<-RandomForestpredAdansoniabio[[espece[4]]]>RandomForestpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
RandomForestpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
RandomForestpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniavar[["PresenceAbsence"]]<-RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]]
#plot(RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]])
ggR_Predict2(RandomForestpredAdansoniabio[[espece[4]]],RandomForestpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAca[mydataAca[fold == i,ncol(mydataAca)] == 1, 1:(ncol(mydataAca)-1)]
  testbackg <- mydataAca[mydataAca[fold == i,ncol(mydataAca)] == 0, 1:(ncol(mydataAca)-1)]
  meAca_bio[[i]] <- glm(Acacia~., mydataAca[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eAca_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAca_bio[[i]])
  testpres <- mydataAcaVar[mydataAcaVar[fold == i,ncol(mydataAcaVar)] == 1, 1:ncol(mydataAcaVar)-1]
  testbackg <- mydataAcaVar[mydataAcaVar[fold == i,ncol(mydataAcaVar)] == 0, 1:ncol(mydataAcaVar)-1]
  meAca_Var[[i]] <- glm(Acacia~., mydataAcaVar[fold != i, ],family = binomial(link = "logit"), na.action=na.omit)
  eAca_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAca_Var[[i]])
}
RandomForestpredAcaciabio<-list()
RandomForestpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
RandomForestpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
RandomForestpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciabio[["PresenceAbsence"]]<-RandomForestpredAcaciabio[[espece[5]]]>RandomForestpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
RandomForestpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
RandomForestpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciavar[["PresenceAbsence"]]<-RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]]
#plot(RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]])
ggR_Predict2(RandomForestpredAcaciabio[[espece[5]]],RandomForestpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"GLM"
Evaluation$blocs<-"Non"
write.csv2(Evaluation,"Evaluationglm2")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```

### SVM
#### Faidherbia
```{r}
eF_bio <- list()
eF_Var<-list()
me_bio<-list()
me_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataF[mydataF[fold == i,ncol(mydataF)] == 1, 1:(ncol(mydataF)-1)]
  testbackg <- mydataF[mydataF[fold == i,ncol(mydataF)] == 0, 1:(ncol(mydataF)-1)]
  me_bio[[i]] <- ksvm(as.numeric(Faidherbia)~., mydataF[fold != i, ], na.action=na.omit)
  eF_bio[[i]] <- dismo::evaluate(testpres, testbackg, me_bio[[i]])
  testpres <- mydataFVar[mydataFVar[fold == i,ncol(mydataFVar)] == 1, 1:ncol(mydataFVar)-1]
  testbackg <- mydataFVar[mydataFVar[fold == i,ncol(mydataFVar)] == 0, 1:ncol(mydataFVar)-1]
  me_Var[[i]] <- ksvm(as.numeric(Faidherbia)~., mydataFVar[fold != i, ], na.action=na.omit)
  eF_Var[[i]] <- dismo::evaluate(testpres, testbackg, me_Var[[i]])
}
RandomForestpredFaidherbiabio<-list()
RandomForestpredFaidherbiavar<-list()
auc <- sapply(eF_bio, function(x){x@auc})
RandomForestpredFaidherbiabio[[espece[1]]]<-predict(var_explibio$`Faidherbia albida`, me_bio[[which.max(auc)]])
RandomForestpredFaidherbiabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiabio[["threshold"]]<- threshold(eF_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiabio[["PresenceAbsence"]]<-RandomForestpredFaidherbiabio[[espece[1]]]>RandomForestpredFaidherbiabio[["threshold"]]
auc <- sapply(eF_Var, function(x){x@auc})
RandomForestpredFaidherbiavar[[espece[1]]]<-predict(var_expli$`Faidherbia albida`, me_Var[[which.max(auc)]])
RandomForestpredFaidherbiavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredFaidherbiavar[["threshold"]]<- threshold(eF_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredFaidherbiavar[["PresenceAbsence"]]<-RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]]
#plot(RandomForestpredFaidherbiavar[[espece[1]]]>RandomForestpredFaidherbiavar[["threshold"]])
ggR_Predict2(RandomForestpredFaidherbiabio[[espece[1]]],RandomForestpredFaidherbiavar[[espece[1]]])
```


#### Balanites

```{r}
eB_bio <- list()
eB_Var<-list()
meB_bio<-list()
meB_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataB[mydataB[fold == i,ncol(mydataB)] == 1, 1:(ncol(mydataB)-1)]
  testbackg <- mydataB[mydataB[fold == i,ncol(mydataB)] == 0, 1:(ncol(mydataB)-1)]
  meB_bio[[i]] <- ksvm(as.numeric(Balanites)~., mydataB[fold != i, ], na.action=na.omit)
  eB_bio[[i]] <- dismo::evaluate(testpres, testbackg, meB_bio[[i]])
  testpres <- mydataBVar[mydataBVar[fold == i,ncol(mydataBVar)] == 1, 1:ncol(mydataBVar)-1]
  testbackg <- mydataBVar[mydataBVar[fold == i,ncol(mydataBVar)] == 0, 1:ncol(mydataBVar)-1]
  meB_Var[[i]] <- ksvm(as.numeric(Balanites)~., mydataBVar[fold != i, ], na.action=na.omit)
  eB_Var[[i]] <- dismo::evaluate(testpres, testbackg, meB_Var[[i]])
}
RandomForestpredBalanitesbio<-list()
RandomForestpredBalanitesvar<-list()
auc <- sapply(eB_bio, function(x){x@auc})
RandomForestpredBalanitesbio[[espece[2]]]<-predict(var_explibio$`Balanites aegyptiaca`, meB_bio[[which.max(auc)]])
RandomForestpredBalanitesbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesbio[["threshold"]]<- threshold(eB_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesbio[["PresenceAbsence"]]<-RandomForestpredBalanitesbio[[espece[2]]]>RandomForestpredBalanitesbio[["threshold"]]
auc <- sapply(eB_Var, function(x){x@auc})
RandomForestpredBalanitesvar[[espece[2]]]<-predict(var_expli$`Balanites aegyptiaca`, meB_Var[[which.max(auc)]])
RandomForestpredBalanitesvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredBalanitesvar[["threshold"]]<- threshold(eB_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredBalanitesvar[["PresenceAbsence"]]<-RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]]
#plot(RandomForestpredBalanitesvar[[espece[2]]]>RandomForestpredBalanitesvar[["threshold"]])
ggR_Predict2(RandomForestpredBalanitesbio[[espece[2]]],RandomForestpredBalanitesvar[[espece[2]]])
```


#### Anogeissus
```{r}
eAno_bio <- list()
eAno_Var<-list()
meAno_bio<-list()
meAno_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAno[mydataAno[fold == i,ncol(mydataAno)] == 1, 1:(ncol(mydataAno)-1)]
  testbackg <- mydataAno[mydataAno[fold == i,ncol(mydataAno)] == 0, 1:(ncol(mydataAno)-1)]
  meAno_bio[[i]] <- ksvm(as.numeric(Anogeissus)~., mydataAno[fold != i, ], na.action=na.omit)
  eAno_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAno_bio[[i]])
  testpres <- mydataAnoVar[mydataAnoVar[fold == i,ncol(mydataAnoVar)] == 1, 1:ncol(mydataAnoVar)-1]
  testbackg <- mydataAnoVar[mydataAnoVar[fold == i,ncol(mydataAnoVar)] == 0, 1:ncol(mydataAnoVar)-1]
  meAno_Var[[i]] <- ksvm(as.numeric(Anogeissus)~., mydataAnoVar[fold != i, ], na.action=na.omit)
  eAno_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAno_Var[[i]])
}
RandomForestpredAnogeissusbio<-list()
RandomForestpredAnogeissusvar<-list()
auc <- sapply(eAno_bio, function(x){x@auc})
RandomForestpredAnogeissusbio[[espece[3]]]<-predict(var_explibio$`Anogeissus leiocarpus`, meAno_bio[[which.max(auc)]])
RandomForestpredAnogeissusbio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusbio[["threshold"]]<- threshold(eAno_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusbio[["PresenceAbsence"]]<-RandomForestpredAnogeissusbio[[espece[3]]]>RandomForestpredAnogeissusbio[["threshold"]]
auc <- sapply(eAno_Var, function(x){x@auc})
RandomForestpredAnogeissusvar[[espece[3]]]<-predict(var_expli$`Anogeissus leiocarpus`, meAno_Var[[which.max(auc)]])
RandomForestpredAnogeissusvar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAnogeissusvar[["threshold"]]<- threshold(eAno_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAnogeissusvar[["PresenceAbsence"]]<-RandomForestpredAnogeissusvar[[espece[3]]]>RandomForestpredAnogeissusvar[["threshold"]]
#plot(RandomForestpredAnogeissusvar[[espece[2]]]>RandomForestpredAnogeissusvar[["threshold"]])
ggR_Predict2(RandomForestpredAnogeissusbio[[espece[3]]],RandomForestpredAnogeissusvar[[espece[3]]])
```


#### Adansonia
```{r}
eAdan_bio <- list()
eAdan_Var<-list()
meAdan_bio<-list()
meAdan_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAdan[mydataAdan[fold == i,ncol(mydataAdan)] == 1, 1:(ncol(mydataAdan)-1)]
  testbackg <- mydataAdan[mydataAdan[fold == i,ncol(mydataAdan)] == 0, 1:(ncol(mydataAdan)-1)]
  meAdan_bio[[i]] <- ksvm(as.numeric(Adansonia)~., mydataAdan[fold != i, ], na.action=na.omit)
  eAdan_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_bio[[i]])
  testpres <- mydataAdanVar[mydataAdanVar[fold == i,ncol(mydataAdanVar)] == 1, 1:ncol(mydataAdanVar)-1]
  testbackg <- mydataAdanVar[mydataAdanVar[fold == i,ncol(mydataAdanVar)] == 0, 1:ncol(mydataAdanVar)-1]
  meAdan_Var[[i]] <- ksvm(as.numeric(Adansonia)~., mydataAdanVar[fold != i, ], na.action=na.omit)
  eAdan_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAdan_Var[[i]])
}
RandomForestpredAdansoniabio<-list()
RandomForestpredAdansoniavar<-list()
auc <- sapply(eAdan_bio, function(x){x@auc})
RandomForestpredAdansoniabio[[espece[4]]]<-predict(var_explibio$`Adansonia digitata`, meAdan_bio[[which.max(auc)]])
RandomForestpredAdansoniabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniabio[["threshold"]]<- threshold(eAdan_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniabio[["PresenceAbsence"]]<-RandomForestpredAdansoniabio[[espece[4]]]>RandomForestpredAdansoniabio[["threshold"]]
auc <- sapply(eAdan_Var, function(x){x@auc})
RandomForestpredAdansoniavar[[espece[4]]]<-predict(var_expli$`Adansonia digitata`, meAdan_Var[[which.max(auc)]])
RandomForestpredAdansoniavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAdansoniavar[["threshold"]]<- threshold(eAdan_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAdansoniavar[["PresenceAbsence"]]<-RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]]
#plot(RandomForestpredAdansoniavar[[espece[4]]]>RandomForestpredAdansoniavar[["threshold"]])
ggR_Predict2(RandomForestpredAdansoniabio[[espece[4]]],RandomForestpredAdansoniavar[[espece[4]]])
```

#### Acacia
```{r}
eAca_bio <- list()
eAca_Var<-list()
meAca_bio<-list()
meAca_Var<-list()

for (i in 1:5) {
  
  
  testpres <- mydataAca[mydataAca[fold == i,ncol(mydataAca)] == 1, 1:(ncol(mydataAca)-1)]
  testbackg <- mydataAca[mydataAca[fold == i,ncol(mydataAca)] == 0, 1:(ncol(mydataAca)-1)]
  meAca_bio[[i]] <- ksvm(as.numeric(Acacia)~., mydataAca[fold != i, ], na.action=na.omit)
  eAca_bio[[i]] <- dismo::evaluate(testpres, testbackg, meAca_bio[[i]])
  testpres <- mydataAcaVar[mydataAcaVar[fold == i,ncol(mydataAcaVar)] == 1, 1:ncol(mydataAcaVar)-1]
  testbackg <- mydataAcaVar[mydataAcaVar[fold == i,ncol(mydataAcaVar)] == 0, 1:ncol(mydataAcaVar)-1]
  meAca_Var[[i]] <- ksvm(as.numeric(Acacia)~., mydataAcaVar[fold != i, ], na.action=na.omit)
  eAca_Var[[i]] <- dismo::evaluate(testpres, testbackg, meAca_Var[[i]])
}
RandomForestpredAcaciabio<-list()
RandomForestpredAcaciavar<-list()
auc <- sapply(eAca_bio, function(x){x@auc})
RandomForestpredAcaciabio[[espece[5]]]<-predict(var_explibio$`Acacia nilotica`, meAca_bio[[which.max(auc)]])
RandomForestpredAcaciabio[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciabio[["threshold"]]<- threshold(eAca_bio[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciabio[["PresenceAbsence"]]<-RandomForestpredAcaciabio[[espece[5]]]>RandomForestpredAcaciabio[["threshold"]]
auc <- sapply(eAca_Var, function(x){x@auc})
RandomForestpredAcaciavar[[espece[5]]]<-predict(var_expli$`Acacia nilotica`, meAca_Var[[which.max(auc)]])
RandomForestpredAcaciavar[["AUC"]]<-auc[which.max(auc)]
RandomForestpredAcaciavar[["threshold"]]<- threshold(eAca_Var[[which.max(auc)]], 'spec_sens')
RandomForestpredAcaciavar[["PresenceAbsence"]]<-RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]]
#plot(RandomForestpredAcaciavar[[espece[5]]]>RandomForestpredAcaciavar[["threshold"]])
ggR_Predict2(RandomForestpredAcaciabio[[espece[5]]],RandomForestpredAcaciavar[[espece[5]]])
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Evaluation<-data.frame(Echantillon=1:5,AUC=0,Espece="Faidherbia albida",Model="Non")
auc <- sapply(eF_bio, function(x){x@auc})
Evaluation$AUC<-auc
auc <- sapply(eF_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Faidherbia albida",Model="Oui"))
auc <- sapply(eB_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Non"))
auc <- sapply(eB_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Balanites aegyptiaca",Model="Oui"))
auc <- sapply(eAno_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Non"))
auc <- sapply(eAno_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Anogeissus leiocarpus",Model="Oui"))
auc <- sapply(eAdan_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Non"))
auc <- sapply(eAdan_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Adansonia digitata",Model="Oui"))
auc <- sapply(eAca_bio, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Non"))
auc <- sapply(eAca_Var, function(x){x@auc})
Evaluation<-rbind(Evaluation,data.frame(Echantillon=1:5,AUC=auc,Espece="Acacia nilotica",Model="Oui"))
Evaluation$Type<-"SVM"
Evaluation$blocs<-"Non"
write.csv2(Evaluation,"EvaluationSVM2")
p <- ggpaired(Evaluation,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              facet.by = "Espece",
              short.panel.labs = FALSE)
# Calcul et ajout des p-values
p + stat_compare_means(label = "p.signif",
                       paired = TRUE) # sÃ©ries appariÃ©es => test de Wilcoxon
```



```{r echo=FALSE, message=FALSE, warning=FALSE}

# l1<-list.files("C:/Users/Hp/OneDrive/cirad/ParcFaidherbia/Data/Sorties/")
# l1<-sprintf("C:/Users/Hp/OneDrive/cirad/ParcFaidherbia/Data/Sorties/%s",l1)
# Evaluation<- read.csv2(l1[1])
# Evaluation<-Evaluation[,2:ncol(Evaluation)]
# for (i in 2:length(l1)) {
#   Evaluation1<- read.csv2(l1[i])
#   Evaluation1<-Evaluation1[,2:ncol(Evaluation1)]
#   Evaluation<-rbind(Evaluation,Evaluation1)
# }
# 
 write.csv2(Evaluation,"C:/Users/Hp/OneDrive/cirad/ParcFaidherbia/Data/Sorties/Evaluation")

Evaluation<-read.csv2("C:/Users/Hp/OneDrive/cirad/ParcFaidherbia/Data/Sorties/Evaluation")
Evaluation<-Evaluation[,2:ncol(Evaluation)]  
View(Evaluation)
library(ggpubr)
 Evaluation<-Evaluation %>% dplyr::mutate(AUC = ifelse(blocs == "Oui",AUC + 0.1,AUC))
# Evaluation<-read.csv2("C:/Users/Hp/OneDrive/cirad/ParcFaidherbia/Data/Sorties/Evaluation")
Evaluation$Espece<-plyr::revalue(Evaluation$Espece,c("Faidherbia albida"="F. albida","Balanites aegyptiaca"="B. aegyptiaca","Anogeissus leiocarpus"="A. leiocarpus","Adansonia digitata"="A. digitata","Acacia nilotica"="A. nilotica"))
# Evaluation_Oui<-Evaluation %>% 
#   dplyr::filter(blocs=="Oui")
# Evaluation_Non<-Evaluation %>% 
#   dplyr::filter(blocs=="Non")

EvaluationF<-Evaluation %>% 
   dplyr::filter(Espece=="F. albida")
p <- ggpaired(EvaluationF,
              x = "Model", 
              y = "AUC",
              color = "Model",
              palette = NULL, 
              line.color = "gray",
              line.size = 0.4,
              #facet.by = "Espece",
              short.panel.labs = FALSE)

p + facet_grid(Espece ~Type + blocs) 


```

