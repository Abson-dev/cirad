plotVariograms = FALSE,
showPlots = TRUE)
if(interactive()){
# load package data
awt <- raster::brick(system.file("extdata", "awt.grd", package = "blockCV"))
# import presence-absence species data
PA <- read.csv(system.file("extdata", "PA.csv", package = "blockCV"))
# make a sf object from data.frame
pa_data <- sf::st_as_sf(PA, coords = c("x", "y"), crs = raster::crs(awt))
rangeExplorer(rasterLayer = awt) # the only mandatory input
# add species data to add them on the map
rangeExplorer(rasterLayer = awt,
speciesData = pa_data,
species = "Species",
rangeTable = NULL,
minRange = 30000, # limit the search domain
maxRange = 100000)
}
awt
#############"
zone_etude1<-shapefile("C:\\Users\\Hp\\OneDrive\\Memoire_ITS4\\shpzones\\Zone_1_BON.shp")
z1<-st_as_sf(zone_etude1)
#########
filename<-paste0("D:\\Stage_SDM\\SDM\\Data\\BD_Arbre","\\arbres_diohine_mai2018_par_Zone_OK_BON.shp")
Species<-st_read(filename,quiet = T)
Base_Espece<-Species
Base_Espece$Faidherbia_albida<-if_else(Base_Espece$Species =="Faidherbia albida","1","0")
Base_Espece$Faidherbia_albida<-as.factor(Base_Espece$Faidherbia_albida)
#####supprimer la géométrie afin de pouvoir faire quelques manipulations
data_df<-st_drop_geometry(Base_Espece)
##########???les espèces dans les différentes zones
Base_Espece_Zone1<-data_df %>%
filter(Zone == 1)
Base_Faidherbia_Z1<-Base_Espece_Zone1 %>%
select(xcoord,ycoord,Faidherbia_albida)
names(Base_Faidherbia_Z1)<-c("lon","lat","Faidherbia")
FZ1<-Base_Faidherbia_Z1
#Transform data as SpatialPointDataFrame
sp::coordinates(FZ1) <-~lon+lat
sp::proj4string(FZ1) <-"+proj=longlat +datum=WGS84"
########↨importation des données de worldclim
###1)prendre les fichiers .tif(raster) qui se trouvent dans le dossier indiquer
l1<-list.files("D:\\Stage_SDM\\SDM\\Data\\WorldClim\\wc2.0_30s_bio\\",patt="\\.tif")
l1<-sprintf("D:\\Stage_SDM\\SDM\\Data\\WorldClim\\wc2.0_30s_bio\\%s",l1)
dataFZ1<-CovarExtract(x=FZ1,cov.paths = l1) # en utilsisant SDMSelect
########"Modélisation de Faidherbia albida dans la zone 1
##zone 1
library(SDMSelect)
dataFZ1<-CovarExtract(x=FZ1,cov.paths = l1) # en utilsisant SDMSelect
DataModelFZ1<-dataFZ1@data
##zone 1
filename_PA_Z1<-paste0("C:\\Users\\Hp\\Desktop\\Model","\\dataFZ1.shp")
PA_FZ1<-shapefile(filename_PA_Z1)
map1<-st_as_sf(PA_FZ1)
map1$Faidherbia<-if_else(map1$Faidherbia ==1,"présence","absence")
map1$Faidherbia<-as.factor(map1$Faidherbia)
###########répresentation graphique des présence/absence de Faidherbia albida dans les zones
plotPAZ1<-ggplot(map1)   +
geom_sf(aes(color = Faidherbia)) +
geom_sf(data = z1, colour = "black", fill = NA)  +
theme_bw() + annotation_scale(location = "bl", width_hint = 0.3) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.1, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering)
library(ggplot2)
library(ggspatial)
library(spdep)
library(RStoolbox)
library(maptools)
###########répresentation graphique des présence/absence de Faidherbia albida dans les zones
plotPAZ1<-ggplot(map1)   +
geom_sf(aes(color = Faidherbia)) +
geom_sf(data = z1, colour = "black", fill = NA)  +
theme_bw() + annotation_scale(location = "bl", width_hint = 0.3) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.1, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering)
plotPAZ1
#Extraire un seul RasterLayer d'un RasterBrick (ou RasterStack).
#r <- raster(b, layer=2)
###)connaitre l'étendue de notre zone d'étude (ext)
ext<-raster::extent(Species)
# class      : Extent
# xmin       : -16.53864
# xmax       : -16.35454
# ymin       : 14.45461
# ymax       : 14.63543
worlClim<-stack(l1)
###)utiliser crop pour mettre a la même zone d'étude les données de worlclim
worldClim.crop<-crop(worlClim,ext)
View(PA)
PA_FZ1
DataModelFZ1
FZ1
Base_Faidherbia_Z1
# add species data to add them on the map
rangeExplorer(rasterLayer = awt,
speciesData = pa_data,
species = "Faidherbia",
rangeTable = NULL,
minRange = 30000, # limit the search domain
maxRange = 100000)
# [1] "bio1"  "bio10" "bio11" "bio12" "bio13" "bio14" "bio15" "bio16"
# [9] "bio17" "bio18" "bio19" "bio2"  "bio3"  "bio4"  "bio5"  "bio6"
# [17] "bio7"  "bio8"  "bio9"
bio1 <- raster(worldClim.crop, layer=1)
# load package data
awt <- bio1
#en tenant compte du mask
# ggR(r, geom_raster = TRUE,ggLayer = F) +
#   scale_fill_gradientn(name = "bio1", colours = terrain.colors(100))  +
#   theme_bw() + annotation_scale(location = "bl", width_hint = 0.3) +
#   annotation_north_arrow(location = "bl", which_north = "true",
#                          pad_x = unit(0.1, "in"), pad_y = unit(0.2, "in"),
#                          style = north_arrow_fancy_orienteering)  +
#   geom_sf(data = z1, colour = "blue", fill = NA)
if(interactive()){
# load package data
awt <- bio1
# import presence-absence species data
PA <- Base_Faidherbia_Z1
# make a sf object from data.frame
pa_data <- sf::st_as_sf(PA, coords = c("lon", "lat"), crs = raster::crs(awt))
rangeExplorer(rasterLayer = awt) # the only mandatory input
# add species data to add them on the map
rangeExplorer(rasterLayer = awt,
speciesData = pa_data,
species = "Faidherbia",
rangeTable = NULL,
minRange = 30000, # limit the search domain
maxRange = 100000)
}
# load the example raster data
awt <- raster::brick(system.file("extdata", "awt.grd", package = "blockCV"))
# run the model in parallel
range1 <- spatialAutoRange(rasterLayer = awt,
sampleNumber = 5000, # number of cells to be used
doParallel = TRUE,
nCores = 2, # if NULL, it uses half of the CPU cores
plotVariograms = FALSE,
showPlots = TRUE)
awt <- raster::brick(system.file("extdata", "awt.grd", package = "blockCV"))
# import presence-absence species data
PA <- read.csv(system.file("extdata", "PA.csv", package = "blockCV"))
# make a sf object from data.frame
pa_data <- sf::st_as_sf(PA, coords = c("x", "y"), crs = raster::crs(awt))
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Species",
theRange = 70000,
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
# spatial blocking by row/column and systematic fold assignment
sb2 <- spatialBlock(speciesData = pa_data,
species = "Species",
rasterLayer = awt,
rows = 5,
cols = 8,
k = 5,
selection = "systematic",
biomod2Format = TRUE)
# spatial blocking by specified range and random assignment
sb <- spatialBlock(speciesData = pa_data, # sf or SpatialPoints
species = "Species", # the response column (binomial or multi-class)
rasterLayer = myrasters, # a raster for backgoround (optional)
theRange = 70000, # size of the blocks
k = 5, # the number of folds
selection = "random",
iteration = 100, # find evenly dispersed folds
biomod2Format = TRUE)
sb2
# load package data
awt <- bio1
# import presence-absence species data
PA <- Base_Faidherbia_Z1
# make a sf object from data.frame
pa_data <- sf::st_as_sf(PA, coords = c("lon", "lat"), crs = raster::crs(awt))
sb2 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
rasterLayer = awt,
rows = 5,
cols = 8,
k = 5,
selection = "systematic",
biomod2Format = TRUE)
# load the example raster data
awt <- raster::brick(system.file("extdata", "awt.grd", package = "blockCV"))
plot(awt)
#############"
zone_etude2<-shapefile("C:\\Users\\Hp\\OneDrive\\Memoire_ITS4\\shpzones\\Zone_2_BON.shp")
library(tidyverse)
library(SDMSelect)
library(dplyr)
library(sf)
library(raster)
library(rasterVis)
library(RStoolbox)
library(maptools)
library(rgdal)
library(spdep)
library(ggplot2)
library(ggspatial)
library(blockCV)
library(randomForest)
library(rJava)
library(dismo)
#############"
zone_etude2<-shapefile("C:\\Users\\Hp\\OneDrive\\Memoire_ITS4\\shpzones\\Zone_2_BON.shp")
z2<-st_as_sf(zone_etude2)
#########
filename<-paste0("D:\\Stage_SDM\\SDM\\Data\\BD_Arbre","\\arbres_diohine_mai2018_par_Zone_OK_BON.shp")
Species<-st_read(filename,quiet = T)
Base_Espece<-Species
Base_Espece$Faidherbia_albida<-if_else(Base_Espece$Species =="Faidherbia albida","1","0")
Base_Espece$Faidherbia_albida<-as.factor(Base_Espece$Faidherbia_albida)
#####supprimer la géométrie afin de pouvoir faire quelques manipulations
data_df<-st_drop_geometry(Base_Espece)
##########???les espèces dans les différentes zones
Base_Espece_Zone2<-data_df %>%
filter(Zone == 2)
Base_Faidherbia_Z2<-Base_Espece_Zone2[,c("xcoord","ycoord","Faidherbia_albida")]
names(Base_Faidherbia_Z2)<-c("lon","lat","Faidherbia")
FZ2<-Base_Faidherbia_Z2
#Transform data as SpatialPointDataFrame
sp::coordinates(FZ2) <-~lon+lat
sp::proj4string(FZ2) <-"+proj=longlat +datum=WGS84"
########???importation des données de worldclim
###1)prendre les fichiers .tif(raster) qui se trouvent dans le dossier indiquer
l1<-list.files("D:\\Stage_SDM\\SDM\\Data\\WorldClim\\wc2.0_30s_bio\\",patt="\\.tif")
l1<-sprintf("D:\\Stage_SDM\\SDM\\Data\\WorldClim\\wc2.0_30s_bio\\%s",l1)
dataFZ2<-CovarExtract(x=FZ2,cov.paths = l1) # en utilsisant SDMSelect
DataModelFZ2<-dataFZ2@data
##zone 1
filename_PA_Z2<-paste0("C:\\Users\\Hp\\Desktop\\Model","\\dataFZ2.shp")
PA_FZ2<-shapefile(filename_PA_Z2)
map2<-st_as_sf(PA_FZ2)
map2$Faidherbia<-if_else(map2$Faidherbia ==1,"présence","absence")
map2$Faidherbia<-as.factor(map2$Faidherbia)
###########répresentation graphique des présence/absence de Faidherbia albida dans les zones
plotPAZ2<-ggplot(map2)   +
geom_sf(aes(color = Faidherbia)) +
geom_sf(data = z2, colour = "black", fill = NA)  +
theme_bw() + annotation_scale(location = "bl", width_hint = 0.3) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.1, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering)
#Extraire un seul RasterLayer d'un RasterBrick (ou RasterStack).
#r <- raster(b, layer=2)
###)connaitre l'étendue de notre zone d'étude (ext)
ext<-raster::extent(Species)
# class      : Extent
# xmin       : -16.53864
# xmax       : -16.35454
# ymin       : 14.45461
# ymax       : 14.63543
worlClim<-stack(l1)
###)utiliser crop pour mettre a la même zone d'étude les données de worlclim
worldClim.crop<-crop(worlClim,ext)
names(worldClim.crop)
# [1] "bio1"  "bio10" "bio11" "bio12" "bio13" "bio14" "bio15" "bio16"
# [9] "bio17" "bio18" "bio19" "bio2"  "bio3"  "bio4"  "bio5"  "bio6"
# [17] "bio7"  "bio8"  "bio9"
bio1 <- raster(worldClim.crop, layer=1)
raster<-bio1
buffer<-z2 #yellow buffer
# SpatialPolygons(zone_etude2)
output<-mask(raster, buffer)
plot(output)
# r <- raster(worldClim.crop, layer=1)
# values(r) <- 1:ncell(r)
# r <- mask(r, z1)
plot(output)
plot(z2$geometry, add=TRUE, lwd=1)
ggR(bio1, geom_raster = TRUE,ggLayer = F) +
scale_fill_gradientn(name = "bio1", colours = terrain.colors(100))  +
theme_bw() + annotation_scale(location = "bl", width_hint = 0.3) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.1, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering)  +
geom_sf(data = z2, colour = "blue", fill = NA)
ggR(output, geom_raster = TRUE,ggLayer = F) +
scale_fill_gradientn(name = "bio1", colours = terrain.colors(100))  +
theme_bw() + annotation_scale(location = "bl", width_hint = 0.3) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.1, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering)  +
geom_sf(data = z2, colour = "blue", fill = NA)
ggR(bio1, geom_raster = TRUE,ggLayer = F) +
scale_fill_gradientn(name = "bio1", colours = terrain.colors(100))  +
theme_bw() + annotation_scale(location = "bl", width_hint = 0.3) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.1, "in"), pad_y = unit(0.2, "in"),
style = north_arrow_fancy_orienteering)  +
geom_sf(data = z2, colour = "blue", fill = NA)
fpa <- as.factor(DataModelFZ2[, 'Faidherbia'])
crf <- randomForest(DataModelFZ2[, 2:ncol(DataModelFZ2)], fpa)
crf
class(crf)
plot(crf)
varImpPlot(crf)
#bio4,bio2,bio3,bio18,bio15,bio10,bio11,bio1
######################constitution des données d'entrainement et test
Faidherbia_pres<-Base_Faidherbia_Z2 %>%
filter(Faidherbia==1)
View(Faidherbia_pres)
Faidherbia_pres<-Faidherbia_pres[,1:2]
presvals<-extract(worldClim.crop,Faidherbia_pres)
View(presvals)
Faidherbia_abs<-Base_Faidherbia_Z2 %>%
filter(Faidherbia==0)
Faidherbia_abs<-Faidherbia_abs[,1:2]
absvals<-extract(worldClim.crop,Faidherbia_abs)
if(interactive()){
# load package data
awt <- bio1
# import presence-absence species data
PA <- Base_Faidherbia_Z2
# make a sf object from data.frame
pa_data <- sf::st_as_sf(PA, coords = c("lon", "lat"), crs = raster::crs(awt))
rangeExplorer(rasterLayer = awt) # the only mandatory input
# add species data to add them on the map
rangeExplorer(rasterLayer = awt,
speciesData = pa_data,
species = "Faidherbia",
rangeTable = NULL,
minRange = 30000, # limit the search domain
maxRange = 100000)
}
sb2 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
rasterLayer = awt,
rows = 5,
cols = 8,
k = 5,
selection = "systematic",
biomod2Format = TRUE)
# investigate spatial autocorrelation in raster covariates
# this helps to choose a suitable size for spatial blocks
spatialAutoRange(rasterLayer = bio1, # raster file
sampleNumber = 5000, # number of cells to be used
doParallel = TRUE,
showPlots = TRUE)
# spatial blocking by specified range and random assignment
sb <- spatialBlock(speciesData = pa_data, # sf or SpatialPoints
species = "Species", # the response column (binomial or multi-class)
rasterLayer = worldClim.crop, # a raster for backgoround (optional)
theRange = 70000, # size of the blocks
k = 5, # the number of folds
selection = "random",
iteration = 100, # find evenly dispersed folds
biomod2Format = TRUE)
# spatial blocking by specified range and random assignment
sb <- spatialBlock(speciesData = pa_data, # sf or SpatialPoints
species = "Species", # the response column (binomial or multi-class)
rasterLayer = bio1, # a raster for backgoround (optional)
theRange = 70000, # size of the blocks
k = 5, # the number of folds
selection = "random",
iteration = 100, # find evenly dispersed folds
biomod2Format = TRUE)
# spatial blocking by specified range and random assignment
sb <- spatialBlock(speciesData = pa_data, # sf or SpatialPoints
species = "Faidherbia", # the response column (binomial or multi-class)
rasterLayer = worldClim.crop, # a raster for backgoround (optional)
theRange = 70000, # size of the blocks
k = 5, # the number of folds
selection = "random",
iteration = 100, # find evenly dispersed folds
biomod2Format = TRUE)
# spatial blocking by specified range and random assignment
sb <- spatialBlock(speciesData = pa_data, # sf or SpatialPoints
species = "Faidherbia", # the response column (binomial or multi-class)
rasterLayer = bio1, # a raster for backgoround (optional)
theRange = 70000, # size of the blocks
k = 5, # the number of folds
selection = "random",
iteration = 100, # find evenly dispersed folds
biomod2Format = TRUE)
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
theRange = 70000,
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
theRange = 700,
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
theRange = 10,
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
border=z2,
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
border=z2,
theRange = 700
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
border=z2,
theRange = 700,
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
View(sb1)
sb1$plots$plot_env
sb1$biomodTable
# run the model in parallel
range1 <- spatialAutoRange(rasterLayer = awt,
sampleNumber = 5000, # number of cells to be used
doParallel = TRUE,
nCores = 2, # if NULL, it uses half of the CPU cores
plotVariograms = FALSE,
showPlots = TRUE)
# show the result
summary(range1)
range1$variograms
plot(range1$plots)
# run the model in parallel
range1 <- spatialAutoRange(rasterLayer = awt,
sampleNumber = 5000, # number of cells to be used
doParallel = TRUE,
nCores = 2, # if NULL, it uses half of the CPU cores
plotVariograms = TRUE,
showPlots = TRUE)
foldExplorer(eb, awt, pa_data)
foldExplorer(sb1, awt, pa_data)
foldExplorer(sb1, awt, pa_data)
z2<-st_as_sf(zone_etude2)
# spatial blocking by specified range and random assignment
sb1 <- spatialBlock(speciesData = pa_data,
species = "Faidherbia",
blocks =z2,
theRange = 700,
k = 5,
selection = "random",
iteration = 100,
numLimit = NULL,
biomod2Format = TRUE,
xOffset = 0.3, # shift the blocks horizontally
yOffset = 0)
sb1
foldExplorer(sb1, awt, pa_data)
# Loading
library(ggcorrplot)
install.packages("ggcorrplot")
# Loading
library(ggcorrplot)
# Compute a correlation matrix
data(mtcars)
corr <- round(cor(mtcars), 1)
head(corr[, 1:6])
# Compute a matrix of correlation p-values
p.mat <- cor_pmat(mtcars)
head(p.mat[, 1:4])
# Visualize the correlation matrix
# --------------------------------
# method = "square" (default)
ggcorrplot(corr)
# Visualize the correlation matrix
# --------------------------------
# method = "square" (default)
ggcorrplot(corr)
# method = "circle"
ggcorrplot(corr, method = "circle")
